<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>æ­´å²ãƒãƒˆãƒ«ï¼ãƒ‹ãƒƒãƒãƒ³å²ã‚¯ã‚¤ã‚º</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ãƒ‹ãƒƒãƒãƒ³å²">
  <meta name="theme-color" content="#0a0a12">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Zen+Antique+Soft&family=Noto+Sans+JP:wght@400;700;900&display=swap');

  :root {
    --ink: #0a0a12;
    --paper: #f5f0e8;
    --red: #cc2200;
    --gold: #d4a017;
    --blue: #1a3a6b;
    --accent: #ff4422;
    --glow: #ffcc00;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; width: 100%; max-width: 420px; min-height: 100vh; position: relative; }
  .screen.active { display: flex; flex-direction: column; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TITLE SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-title {
    background: linear-gradient(160deg, #0a0a12 0%, #1a0a05 60%, #0a0010 100%);
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    position: relative;
    overflow: hidden;
  }

  .title-bg-lines {
    position: absolute; inset: 0; pointer-events: none;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 48px,
      rgba(212,160,23,0.06) 48px, rgba(212,160,23,0.06) 49px
    ),
    repeating-linear-gradient(
      90deg, transparent, transparent 48px,
      rgba(212,160,23,0.04) 48px, rgba(212,160,23,0.04) 49px
    );
  }

  .title-seal {
    width: 90px; height: 90px;
    border: 3px solid var(--gold);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 24px;
    position: relative;
    animation: rotateSeal 20s linear infinite;
    box-shadow: 0 0 30px rgba(212,160,23,0.4), inset 0 0 20px rgba(212,160,23,0.1);
  }
  .title-seal::before {
    content: '';
    position: absolute; inset: 5px;
    border: 1px solid rgba(212,160,23,0.4);
    border-radius: 50%;
  }
  .title-seal-kanji {
    font-family: 'Zen Antique Soft', serif;
    font-size: 36px; color: var(--gold);
    text-shadow: 0 0 20px rgba(212,160,23,0.8);
  }
  @keyframes rotateSeal { to { transform: rotate(360deg); } }

  .title-eyebrow {
    font-size: 11px; letter-spacing: 0.4em; color: var(--gold);
    text-transform: uppercase; margin-bottom: 12px;
    opacity: 0.8;
  }

  .title-main {
    font-family: 'Zen Antique Soft', serif;
    font-size: 42px; line-height: 1.1;
    color: var(--paper);
    text-align: center;
    text-shadow: 4px 4px 0 var(--red), 0 0 40px rgba(204,34,0,0.4);
    margin-bottom: 8px;
    animation: titlePulse 3s ease-in-out infinite;
  }
  @keyframes titlePulse {
    0%,100% { text-shadow: 4px 4px 0 var(--red), 0 0 40px rgba(204,34,0,0.3); }
    50% { text-shadow: 4px 4px 0 var(--red), 0 0 60px rgba(204,34,0,0.6), 0 0 100px rgba(255,68,34,0.2); }
  }

  .title-sub {
    font-size: 13px; color: rgba(245,240,232,0.6);
    letter-spacing: 0.15em; margin-bottom: 40px;
    text-align: center;
  }

  /* Character illustration area */
  .title-chars {
    display: flex; justify-content: center; gap: 0;
    margin-bottom: 40px;
    position: relative;
  }

  .char-card {
    width: 90px; height: 130px;
    position: relative;
    cursor: default;
  }
  .char-card:nth-child(1) { transform: rotate(-8deg) translateX(10px); z-index: 1; }
  .char-card:nth-child(2) { transform: translateY(-10px); z-index: 3; }
  .char-card:nth-child(3) { transform: rotate(8deg) translateX(-10px); z-index: 1; }

  .char-avatar {
    width: 100%; height: 100%;
    border-radius: 8px;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    font-family: 'Zen Antique Soft', serif;
    border: 2px solid;
    position: relative;
    overflow: hidden;
  }
  .char-card:nth-child(1) .char-avatar { background: linear-gradient(160deg,#1a0050,#0a002a); border-color: #7b2fff; }
  .char-card:nth-child(2) .char-avatar { background: linear-gradient(160deg,#4a0000,#200000); border-color: var(--red); box-shadow: 0 0 20px rgba(204,34,0,0.5); }
  .char-card:nth-child(3) .char-avatar { background: linear-gradient(160deg,#002a4a,#00101a); border-color: #00aaff; }

  .char-emoji { font-size: 44px; line-height: 1; margin-bottom: 4px; }
  .char-name-tag {
    font-size: 9px; color: rgba(255,255,255,0.7);
    letter-spacing: 0.05em; text-align: center;
    padding: 0 4px;
  }
  .char-era-badge {
    position: absolute; bottom: 6px; left: 0; right: 0;
    text-align: center; font-size: 8px;
    color: rgba(255,255,255,0.5);
  }

  .speed-lines {
    position: absolute; inset: -20px; pointer-events: none;
    background: repeating-conic-gradient(
      rgba(255,255,255,0.02) 0deg 5deg,
      transparent 5deg 10deg
    );
    border-radius: 50%;
    animation: spinLines 8s linear infinite;
  }
  @keyframes spinLines { to { transform: rotate(360deg); } }

  .start-btn {
    background: var(--red);
    color: white;
    border: none; border-radius: 4px;
    padding: 18px 48px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 18px; font-weight: 900;
    letter-spacing: 0.1em;
    cursor: pointer;
    position: relative; overflow: hidden;
    box-shadow: 0 6px 0 #7a1100, 0 8px 20px rgba(204,34,0,0.4);
    transition: transform 0.1s, box-shadow 0.1s;
    clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  }
  .start-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #7a1100; }
  .start-btn::after {
    content: '';
    position: absolute; top: 0; left: -100%;
    width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: btnShine 2.5s ease-in-out infinite;
  }
  @keyframes btnShine { to { left: 200%; } }

  .version-tag {
    position: absolute; bottom: 20px;
    font-size: 10px; color: rgba(245,240,232,0.3);
    letter-spacing: 0.2em;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ERA SELECT SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-era {
    background: #0d0d18;
    padding: 0;
    overflow-y: auto;
  }

  .era-header {
    background: linear-gradient(180deg, #0a0a12, transparent);
    padding: 24px 20px 16px;
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(10px);
  }
  .era-header-top {
    display: flex; align-items: center; gap: 12px; margin-bottom: 4px;
  }
  .back-btn {
    background: none; border: 1px solid rgba(245,240,232,0.2);
    color: rgba(245,240,232,0.7); border-radius: 4px;
    padding: 6px 10px; cursor: pointer; font-size: 12px;
    font-family: 'Noto Sans JP', sans-serif;
  }
  .era-header h2 {
    font-family: 'Zen Antique Soft', serif;
    font-size: 20px; color: var(--paper);
  }
  .era-header p {
    font-size: 11px; color: rgba(245,240,232,0.4); letter-spacing: 0.1em;
  }

  .era-timeline {
    padding: 16px 20px 40px;
    position: relative;
  }
  .era-timeline::before {
    content: '';
    position: absolute; left: 36px; top: 20px; bottom: 40px;
    width: 2px;
    background: linear-gradient(180deg, var(--gold), rgba(212,160,23,0.1));
  }

  .era-item {
    display: flex; align-items: center; gap: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    animation: fadeSlideIn 0.3s ease both;
  }
  .era-item:nth-child(1) { animation-delay: 0.05s; }
  .era-item:nth-child(2) { animation-delay: 0.1s; }
  .era-item:nth-child(3) { animation-delay: 0.15s; }
  .era-item:nth-child(4) { animation-delay: 0.2s; }
  .era-item:nth-child(5) { animation-delay: 0.25s; }
  .era-item:nth-child(6) { animation-delay: 0.3s; }
  .era-item:nth-child(7) { animation-delay: 0.35s; }
  .era-item:nth-child(8) { animation-delay: 0.4s; }
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .era-dot {
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0; position: relative; z-index: 1;
    border: 2px solid;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .era-item:hover .era-dot { transform: scale(1.2); }
  .era-item:hover .era-card { transform: translateX(4px); }

  .era-card {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 12px 16px;
    transition: background 0.2s, transform 0.2s, border-color 0.2s;
    position: relative; overflow: hidden;
  }
  .era-item:hover .era-card {
    background: rgba(255,255,255,0.08);
    border-color: rgba(255,255,255,0.2);
  }
  .era-card-name {
    font-family: 'Zen Antique Soft', serif;
    font-size: 16px; color: var(--paper); margin-bottom: 2px;
  }
  .era-card-period {
    font-size: 10px; color: rgba(245,240,232,0.4); letter-spacing: 0.1em;
  }
  .era-card-count {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    font-size: 10px; color: rgba(245,240,232,0.3);
  }
  .era-card-bar {
    position: absolute; bottom: 0; left: 0;
    height: 2px; border-radius: 0 0 8px 8px;
    transition: width 0.4s ease;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     QUIZ SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-quiz {
    background: #0d0d18;
    padding: 0;
  }

  .quiz-topbar {
    padding: 16px 20px 12px;
    display: flex; align-items: center; gap: 12px;
    background: rgba(10,10,18,0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .quiz-era-label {
    font-size: 11px; color: var(--gold); letter-spacing: 0.1em;
    font-weight: 700; flex: 1;
  }
  .quiz-score-display {
    font-family: 'Zen Antique Soft', serif;
    font-size: 18px; color: var(--paper);
  }
  .quiz-score-display span { color: var(--gold); font-size: 22px; }

  .timer-bar-wrap {
    padding: 0 20px 0;
  }
  .timer-bar-bg {
    height: 6px; background: rgba(255,255,255,0.08);
    border-radius: 3px; overflow: hidden; margin-top: 8px;
  }
  .timer-bar-fill {
    height: 100%; border-radius: 3px;
    background: linear-gradient(90deg, var(--gold), var(--accent));
    transition: width 1s linear, background 0.3s;
  }
  .timer-text {
    font-size: 11px; color: rgba(245,240,232,0.4);
    text-align: right; margin-top: 2px;
  }

  .quiz-char-area {
    padding: 16px 20px 0;
    display: flex; align-items: flex-end; gap: 16px;
    min-height: 160px;
  }
  .quiz-char-figure {
    width: 100px; flex-shrink: 0;
    display: flex; flex-direction: column; align-items: center;
  }
  .quiz-char-emoji {
    font-size: 72px; line-height: 1;
    filter: drop-shadow(0 0 20px rgba(255,200,0,0.3));
    animation: charFloat 3s ease-in-out infinite;
  }
  @keyframes charFloat {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  .quiz-char-name {
    font-size: 10px; color: rgba(245,240,232,0.5);
    margin-top: 4px; letter-spacing: 0.05em;
  }

  .speech-bubble {
    flex: 1;
    background: rgba(245,240,232,0.06);
    border: 1px solid rgba(245,240,232,0.12);
    border-radius: 12px 12px 12px 4px;
    padding: 14px 16px;
    position: relative;
  }
  .speech-bubble::before {
    content: '';
    position: absolute; left: -8px; bottom: 20px;
    border: 8px solid transparent;
    border-right-color: rgba(245,240,232,0.12);
  }
  .speech-bubble-inner::after {
    content: '';
    position: absolute; left: -6px; bottom: 21px;
    border: 7px solid transparent;
    border-right-color: rgba(245,240,232,0.06);
  }

  .q-number {
    font-size: 10px; color: var(--gold); letter-spacing: 0.1em;
    font-weight: 700; margin-bottom: 8px;
  }
  .q-text {
    font-size: 15px; line-height: 1.7;
    color: var(--paper);
    font-weight: 700;
  }

  .choices-area {
    padding: 20px 20px 30px;
    display: flex; flex-direction: column; gap: 10px;
  }

  .choice-btn {
    background: rgba(255,255,255,0.05);
    border: 1.5px solid rgba(255,255,255,0.12);
    border-radius: 8px;
    padding: 14px 18px;
    color: var(--paper);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 14px; font-weight: 700;
    text-align: left;
    cursor: pointer;
    display: flex; align-items: center; gap: 12px;
    transition: background 0.15s, border-color 0.15s, transform 0.1s;
    position: relative; overflow: hidden;
  }
  .choice-btn:not(.disabled):hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.25);
    transform: translateX(4px);
  }
  .choice-btn:not(.disabled):active { transform: scale(0.98); }

  .choice-label {
    width: 26px; height: 26px; border-radius: 50%;
    background: rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 900; flex-shrink: 0;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .choice-btn.correct {
    background: rgba(0,200,100,0.15);
    border-color: #00c864;
    animation: correctPulse 0.4s ease;
  }
  .choice-btn.correct .choice-label { background: #00c864; border-color: #00c864; }
  @keyframes correctPulse {
    0% { transform: scale(1); }
    40% { transform: scale(1.03); }
    100% { transform: scale(1); }
  }

  .choice-btn.wrong {
    background: rgba(204,34,0,0.15);
    border-color: var(--red);
    animation: wrongShake 0.4s ease;
  }
  .choice-btn.wrong .choice-label { background: var(--red); border-color: var(--red); }
  @keyframes wrongShake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .choice-btn.disabled { cursor: default; }

  /* Combo flash */
  .combo-flash {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
    font-family: 'Zen Antique Soft', serif;
    font-size: 64px; font-weight: 900;
    pointer-events: none; z-index: 100;
    opacity: 0;
    text-shadow: 0 0 30px currentColor;
  }
  .combo-flash.show {
    animation: comboAnim 0.8s ease forwards;
  }
  @keyframes comboAnim {
    0% { opacity: 0; transform: translate(-50%,-50%) scale(0.3) rotate(-10deg); }
    30% { opacity: 1; transform: translate(-50%,-50%) scale(1.2) rotate(3deg); }
    60% { opacity: 1; transform: translate(-50%,-50%) scale(1) rotate(0deg); }
    100% { opacity: 0; transform: translate(-50%,-50%) scale(1.1) rotate(0deg) translateY(-30px); }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULT SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-result {
    background: linear-gradient(160deg, #0a0a12 0%, #1a0a05 60%, #0a0010 100%);
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    text-align: center;
    position: relative; overflow: hidden;
  }

  .result-burst {
    position: absolute; inset: 0; pointer-events: none;
    background: repeating-conic-gradient(
      rgba(212,160,23,0.03) 0deg 10deg,
      transparent 10deg 20deg
    );
    animation: spinLines 15s linear infinite;
  }

  .result-rank {
    font-family: 'Zen Antique Soft', serif;
    font-size: 80px; line-height: 1;
    margin-bottom: 8px;
    animation: rankAppear 0.6s cubic-bezier(0.175,0.885,0.32,1.275) both;
  }
  @keyframes rankAppear {
    from { opacity: 0; transform: scale(0); }
    to { opacity: 1; transform: scale(1); }
  }

  .result-title-label {
    font-size: 12px; color: var(--gold); letter-spacing: 0.3em;
    margin-bottom: 4px;
  }
  .result-title-text {
    font-family: 'Zen Antique Soft', serif;
    font-size: 28px; color: var(--paper); margin-bottom: 24px;
  }

  .result-score-box {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px 40px;
    margin-bottom: 32px;
  }
  .result-score-num {
    font-family: 'Zen Antique Soft', serif;
    font-size: 56px; color: var(--gold);
    text-shadow: 0 0 30px rgba(212,160,23,0.6);
    line-height: 1;
  }
  .result-score-label { font-size: 12px; color: rgba(245,240,232,0.5); margin-top: 4px; }
  .result-correct-count { font-size: 14px; color: rgba(245,240,232,0.6); margin-top: 8px; }

  .result-char-unlocked {
    background: rgba(212,160,23,0.1);
    border: 1px solid rgba(212,160,23,0.3);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 32px;
    display: flex; align-items: center; gap: 12px;
  }
  .result-char-unlocked-emoji { font-size: 48px; }
  .result-char-unlocked-text { text-align: left; }
  .result-char-unlocked-label {
    font-size: 10px; color: var(--gold); letter-spacing: 0.2em; margin-bottom: 4px;
  }
  .result-char-unlocked-name {
    font-family: 'Zen Antique Soft', serif;
    font-size: 18px; color: var(--paper);
  }

  .result-btns { display: flex; flex-direction: column; gap: 12px; width: 100%; }
  .result-btn-primary {
    background: var(--red); color: white;
    border: none; border-radius: 4px; padding: 16px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 16px; font-weight: 900;
    cursor: pointer;
    box-shadow: 0 4px 0 #7a1100;
    transition: transform 0.1s, box-shadow 0.1s;
    clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  }
  .result-btn-primary:active { transform: translateY(3px); box-shadow: 0 1px 0 #7a1100; }
  .result-btn-secondary {
    background: transparent; color: rgba(245,240,232,0.6);
    border: 1px solid rgba(245,240,232,0.15); border-radius: 4px; padding: 14px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 14px; font-weight: 700;
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s;
  }
  .result-btn-secondary:hover { border-color: rgba(245,240,232,0.4); color: var(--paper); }

  /* particles */
  .particle {
    position: fixed; pointer-events: none; z-index: 50;
    width: 8px; height: 8px; border-radius: 50%;
    animation: particleFly 1s ease forwards;
  }
  @keyframes particleFly {
    to { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
  }
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="screen-title" class="screen active">
  <div class="title-bg-lines"></div>
  <div class="title-seal"><span class="title-seal-kanji">å²</span></div>
  <div class="title-eyebrow">NIHON-SHI QUIZ BATTLE</div>
  <div class="title-main">æ­´å²ãƒãƒˆãƒ«ï¼<br>ãƒ‹ãƒƒãƒãƒ³å²</div>
  <div class="title-sub">ç¸„æ–‡ã‹ã‚‰è¿‘ç¾ä»£ã¾ã§ å…¨æ™‚ä»£ã«æŒ‘ã‚</div>

  <div class="title-chars">
    <div class="speed-lines"></div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">ğŸº</div>
        <div class="char-name-tag">å‘å¼¥å‘¼</div>
        <div class="char-era-badge">å¼¥ç”Ÿ</div>
      </div>
    </div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">âš”ï¸</div>
        <div class="char-name-tag">ç¹”ç”°ä¿¡é•·</div>
        <div class="char-era-badge">æˆ¦å›½</div>
      </div>
    </div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">ğŸŒŠ</div>
        <div class="char-name-tag">å‚æœ¬é¾é¦¬</div>
        <div class="char-era-badge">å¹•æœ«</div>
      </div>
    </div>
  </div>

  <button class="start-btn" onclick="showEraSelect()">ã¯ã€€ã˜ã€€ã‚ã€€ã‚‹</button>
  <div class="version-tag">PROTOTYPE v0.1 â€” å±±å·æº–æ‹ </div>
</div>

<!-- ERA SELECT SCREEN -->
<div id="screen-era" class="screen">
  <div class="era-header">
    <div class="era-header-top">
      <button class="back-btn" onclick="showTitle()">â† ã‚‚ã©ã‚‹</button>
      <h2>â›© æ™‚ä»£ã‚’é¸ã¹</h2>
    </div>
    <p>CHOOSE YOUR ERA â€” å…¨8æ™‚ä»£</p>
  </div>

  <div class="era-timeline" id="eraTimeline"></div>
</div>

<!-- QUIZ SCREEN -->
<div id="screen-quiz" class="screen">
  <div class="quiz-topbar">
    <div class="quiz-era-label" id="quizEraLabel">æˆ¦å›½æ™‚ä»£</div>
    <div class="quiz-score-display">Score <span id="scoreDisplay">0</span></div>
  </div>
  <div class="timer-bar-wrap">
    <div class="timer-bar-bg">
      <div class="timer-bar-fill" id="timerBar" style="width:100%"></div>
    </div>
    <div class="timer-text" id="timerText">20ç§’</div>
  </div>
  <div class="quiz-char-area">
    <div class="quiz-char-figure">
      <div class="quiz-char-emoji" id="quizCharEmoji">âš”ï¸</div>
      <div class="quiz-char-name" id="quizCharName">ç¹”ç”°ä¿¡é•·</div>
    </div>
    <div class="speech-bubble">
      <div class="q-number" id="qNumber">å•1 / 5</div>
      <div class="q-text" id="qText">å•é¡Œæ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™</div>
    </div>
  </div>
  <div class="choices-area" id="choicesArea"></div>
</div>

<!-- RESULT SCREEN -->
<div id="screen-result" class="screen">
  <div class="result-burst"></div>
  <div class="result-rank" id="resultRank">â­</div>
  <div class="result-title-label">ç§°ã€€å·</div>
  <div class="result-title-text" id="resultTitle">å¤©ä¸‹çµ±ä¸€ã¸ã®é“</div>
  <div class="result-score-box">
    <div class="result-score-num" id="resultScore">0</div>
    <div class="result-score-label">SCORE</div>
    <div class="result-correct-count" id="resultCorrect">5å•ä¸­ 0å•æ­£è§£</div>
  </div>
  <div class="result-char-unlocked">
    <div class="result-char-unlocked-emoji" id="unlockedEmoji">âš”ï¸</div>
    <div class="result-char-unlocked-text">
      <div class="result-char-unlocked-label">ğŸ”“ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è§£æ”¾ï¼</div>
      <div class="result-char-unlocked-name" id="unlockedName">ç¹”ç”°ä¿¡é•·</div>
    </div>
  </div>
  <div class="result-btns">
    <button class="result-btn-primary" onclick="replayQuiz()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼</button>
    <button class="result-btn-secondary" onclick="showEraSelect()">æ™‚ä»£é¸æŠã¸ã‚‚ã©ã‚‹</button>
  </div>
</div>

<!-- COMBO FLASH -->
<div class="combo-flash" id="comboFlash"></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ERAS = [
  {
    id:'jomon', name:'ç¸„æ–‡ãƒ»å¼¥ç”Ÿ', period:'ã€œ3ä¸–ç´€',
    emoji:'ğŸº', color:'#8B6914', glow:'rgba(139,105,20,0.4)',
    char:'å‘å¼¥å‘¼', charEmoji:'ğŸº',
    questions:[
      { q:'ç¸„æ–‡æ™‚ä»£ã‚’ä»£è¡¨ã™ã‚‹åœŸå™¨ã®ç‰¹å¾´ã¯ï¼Ÿ', choices:['ç¸„ç›®ã®æ–‡æ§˜ãŒã‚ã‚‹','è¡¨é¢ãŒãªã‚ã‚‰ã‹','é‡‘å±ãŒæ··ã˜ã£ã¦ã„ã‚‹','å½©è‰²ãŒæ–½ã•ã‚Œã¦ã„ã‚‹'], ans:0,
        hint:'ç¸„ã‚’è»¢ãŒã—ã¦æ¨¡æ§˜ã‚’ã¤ã‘ãŸã®ãŒåå‰ã®ç”±æ¥ã ã‚ˆï¼' },
      { q:'å¼¥ç”Ÿæ™‚ä»£ã«å¤§é™¸ã‹ã‚‰ä¼ã‚ã£ãŸè¾²æ¥­ã®ä¸­å¿ƒã¯ä½•ï¼Ÿ', choices:['éº¦ä½œ','ç¨²ä½œ','èŠ‹ä½œ','è±†ä½œ'], ans:1,
        hint:'ç¾ä»£ã®æ—¥æœ¬äººã®ä¸»é£Ÿã«ã‚‚ãªã£ã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'é‚ªé¦¬å°å›½ã®å¥³ç‹ã¨ã—ã¦é­å¿—å€­äººä¼ã«è¨˜ã•ã‚ŒãŸäººç‰©ã¯ï¼Ÿ', choices:['ç¥åŠŸçš‡å','å‘å¼¥å‘¼','æ¨å¤å¤©çš‡','æŒçµ±å¤©çš‡'], ans:1,
        hint:'å‘ªè¡“çš„ãªåŠ›ã§å›½ã‚’æ²»ã‚ãŸã¨ã•ã‚Œã‚‹è¬å¤šãå¥³ç‹ã ï¼' },
      { q:'ç¸„æ–‡æ™‚ä»£ã®äººã€…ãŒé£Ÿã¹ãŸã‚‚ã®ã‚’æ¨ã¦ãŸå ´æ‰€ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['åœŸå¡','å €','è²å¡š','ç’°æ¿ '], ans:2,
        hint:'è²ã®æ®»ãªã©ãŒç©ã¿é‡ãªã£ãŸå ´æ‰€ã®ã“ã¨ã ã‚ˆï¼' },
      { q:'å¼¥ç”Ÿæ™‚ä»£ã®é›†è½ã‚’å®ˆã‚‹ãŸã‚ã«æ˜ã‚‰ã‚ŒãŸå €ã®ã‚ã‚‹æ‘ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['å±±åŸ','ç’°æ¿ é›†è½','è˜åœ’','æ¡é‡Œ'], ans:1,
        hint:'ã¾ã‚ã‚Šã‚’ãã‚‹ã£ã¨å €ã§å›²ã‚“ã é›†è½ã ã‚ˆï¼' },
    ]
  },
  {
    id:'asuka', name:'å¤å¢³ãƒ»é£›é³¥', period:'3ã€œ7ä¸–ç´€',
    emoji:'ğŸ—¿', color:'#5a4f9a', glow:'rgba(90,79,154,0.4)',
    char:'è–å¾³å¤ªå­', charEmoji:'ğŸ“œ',
    questions:[
      { q:'ã€Œå’Œã‚’ä»¥ã¦è²´ã—ã¨ãªã™ã€ã§å§‹ã¾ã‚‹æ†²æ³•ã‚’åˆ¶å®šã—ãŸã®ã¯ï¼Ÿ', choices:['å¤©æ­¦å¤©çš‡','è–å¾³å¤ªå­','è—¤åŸéŒè¶³','ä¸­å¤§å…„çš‡å­'], ans:1,
        hint:'ä¸€åº¦ã«10äººã®è©±ã‚’èã‘ãŸã¨ã„ã†ä¼èª¬ã®äººç‰©ã ï¼' },
      { q:'645å¹´ã«è¡Œã‚ã‚ŒãŸæ”¿æ²»æ”¹é©ã®åç§°ã¯ï¼Ÿ', choices:['æ‰¿ä¹…ã®ä¹±','å¤§åŒ–ã®æ”¹æ–°','å£¬ç”³ã®ä¹±','å¿œä»ã®ä¹±'], ans:1,
        hint:'å¹´å·ãŒã€Œå¤§åŒ–ã€ã«æ”¹ã‚ã‚‰ã‚ŒãŸæ”¹é©ã ã‚ˆï¼' },
      { q:'å¤§å’Œæ”¿æ¨©ã®ç‹ã‚’ä½•ã¨å‘¼ã‚“ã ã‹ï¼Ÿ', choices:['å°†è»','å¤©çš‡','å¤§ç‹(ãŠãŠãã¿)','å¹•åºœ'], ans:2,
        hint:'å½“æ™‚ã¯ã¾ã ã€Œå¤©çš‡ã€ã¨ã„ã†è¨€è‘‰ã¯ä½¿ã‚ã‚Œã¦ã„ãªã‹ã£ãŸã‚ˆï¼' },
      { q:'å¤å¢³ã®å½¢ã¨ã—ã¦æœ€ã‚‚å¤§ããªå‰æ–¹å¾Œå††å¢³ãŒã‚ã‚‹å ´æ‰€ã¯ï¼Ÿ', choices:['å¥ˆè‰¯','å¤§é˜ª','äº¬éƒ½','ç¦å²¡'], ans:1,
        hint:'ä»å¾³å¤©çš‡é™µã¯ä¸–ç•Œæœ€å¤§è¦æ¨¡ã®å¢³å¢“ã ã‚ˆï¼' },
      { q:'è–å¾³å¤ªå­ãŒå»ºç«‹ã—ãŸã¨ã•ã‚Œã‚‹å¯ºé™¢ã¯ï¼Ÿ', choices:['æ±å¤§å¯º','æ³•éš†å¯º','å”æ‹›æå¯º','å»¶æš¦å¯º'], ans:1,
        hint:'ç¾å­˜ã™ã‚‹ä¸–ç•Œæœ€å¤ã®æœ¨é€ å»ºç¯‰ç¾¤ã ã‚ˆï¼' },
    ]
  },
  {
    id:'nara', name:'å¥ˆè‰¯ãƒ»å¹³å®‰', period:'8ã€œ12ä¸–ç´€',
    emoji:'ğŸ¦Œ', color:'#3a7a3a', glow:'rgba(58,122,58,0.4)',
    char:'è—¤åŸé“é•·', charEmoji:'ğŸŒ•',
    questions:[
      { q:'ã€Œã“ã®ä¸–ã‚’ã°æˆ‘ãŒä¸–ã¨ãæ€ãµã€ã¨è© ã‚“ã äººç‰©ã¯ï¼Ÿ', choices:['ç´«å¼éƒ¨','è—¤åŸé“é•·','åœ¨åŸæ¥­å¹³','è…åŸé“çœŸ'], ans:1,
        hint:'å¨˜3äººãŒå¤©çš‡ã®å¦ƒã«ãªã£ãŸçµ¶é ‚æœŸã®æ­Œã ã‚ˆï¼' },
      { q:'å¥ˆè‰¯æ™‚ä»£ã«å…¨å›½ã«ç½®ã‹ã‚ŒãŸå›½ã”ã¨ã®å¯ºã®åç§°ã¯ï¼Ÿ', choices:['å»¶æš¦å¯º','å›½åˆ†å¯º','æ³•éš†å¯º','èˆˆç¦å¯º'], ans:1,
        hint:'å›½ã‚’å®ˆã‚‹ãŸã‚ã«å…¨å›½ã«å»ºã¦ã‚‰ã‚ŒãŸå¯ºã ã‚ˆï¼' },
      { q:'æºæ°ç‰©èªã‚’æ›¸ã„ãŸä½œå®¶ã¯ï¼Ÿ', choices:['æ¸…å°‘ç´è¨€','ç´«å¼éƒ¨','å’Œæ³‰å¼éƒ¨','å°é‡å°ç”º'], ans:1,
        hint:'ä¸–ç•Œæœ€å¤ã®é•·ç·¨å°èª¬ã¨ã‚‚ã„ã‚ã‚Œã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'å¹³å®‰æ™‚ä»£ã«å‹¢åŠ›ã‚’èª‡ã£ãŸæ°æ—ã¯ï¼Ÿ', choices:['æºæ°','å¹³æ°','è—¤åŸæ°','æ©˜æ°'], ans:2,
        hint:'æ‘‚é–¢æ”¿æ²»ã§å¤©çš‡å®¶ã¨ã®å©šå§»é–¢ä¿‚ã‚’åˆ©ç”¨ã—ãŸæ°æ—ã ã‚ˆï¼' },
      { q:'å¥ˆè‰¯ã®å¤§ä»ï¼ˆæ±å¤§å¯ºç›§èˆé‚£ä»ï¼‰ã‚’å»ºç«‹ã—ãŸå¤©çš‡ã¯ï¼Ÿ', choices:['è–æ­¦å¤©çš‡','æ¡“æ­¦å¤©çš‡','åµ¯å³¨å¤©çš‡','é†é†å¤©çš‡'], ans:0,
        hint:'ä»ã®åŠ›ã§å›½ã‚’æ²»ã‚ã‚ˆã†ã¨ã—ãŸå¤©çš‡ã ã‚ˆï¼' },
    ]
  },
  {
    id:'kamakura', name:'éŒå€‰ãƒ»å®¤ç”º', period:'12ã€œ15ä¸–ç´€',
    emoji:'â›©', color:'#7a2020', glow:'rgba(122,32,32,0.5)',
    char:'æºé ¼æœ', charEmoji:'ğŸ¯',
    questions:[
      { q:'éŒå€‰å¹•åºœã‚’é–‹ã„ãŸäººç‰©ã¯ï¼Ÿ', choices:['æºç¾©çµŒ','æºé ¼æœ','åŒ—æ¡æ™‚å®—','è¶³åˆ©å°Šæ°'], ans:1,
        hint:'å¼Ÿãƒ»ç¾©çµŒã¨ã®ç¢ºåŸ·ã§ã‚‚æœ‰åãªæ­¦å°†ã ã‚ˆï¼' },
      { q:'å…ƒã®å¤§è»ãŒ2åº¦ã«ã‚ãŸã£ã¦æ—¥æœ¬ã«æ”»ã‚ã¦ããŸå‡ºæ¥äº‹ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['å£¬ç”³ã®ä¹±','å…ƒå¯‡','ä¿å…ƒã®ä¹±','å¿œä»ã®ä¹±'], ans:1,
        hint:'æš´é¢¨é›¨ï¼ˆç¥é¢¨ï¼‰ãŒæ—¥æœ¬ã‚’æ•‘ã£ãŸã¨ã‚‚è¨€ã‚ã‚Œã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'å®¤ç”ºå¹•åºœã‚’é–‹ã„ãŸäººç‰©ã¯ï¼Ÿ', choices:['è¶³åˆ©ç¾©æº€','è¶³åˆ©å°Šæ°','è¶³åˆ©ç¾©æ”¿','è¶³åˆ©ç¾©æ˜­'], ans:1,
        hint:'å—åŒ—æœã®å¯¾ç«‹ã‚’çµ‚ã‚ã‚‰ã›ãŸäººç‰©ã ã‚ˆï¼' },
      { q:'1467å¹´ã«å§‹ã¾ã£ãŸç´„11å¹´é–“ç¶šãå¤§ä¹±ã®åå‰ã¯ï¼Ÿ', choices:['æ‰¿ä¹…ã®ä¹±','é–¢ãƒ¶åŸã®æˆ¦ã„','å¿œä»ã®ä¹±','æ¡¶ç‹­é–“ã®æˆ¦ã„'], ans:2,
        hint:'ã“ã®ä¹±ã§äº¬éƒ½ã¯ç„¼ã‘é‡åŸã«ãªã‚Šæˆ¦å›½æ™‚ä»£ã«çªå…¥ã—ãŸã‚ˆï¼' },
      { q:'éŒå€‰æ™‚ä»£ã«æ­¦å£«ãŒå®ˆã‚‹ã¹ãé“å¾³ã€Œå¾¡æˆæ•—å¼ç›®ã€ã‚’åˆ¶å®šã—ãŸã®ã¯ï¼Ÿ', choices:['åŒ—æ¡æ³°æ™‚','æºé ¼æœ','å¾Œé³¥ç¾½ä¸Šçš‡','åŒ—æ¡æ™‚å®—'], ans:0,
        hint:'æ­¦å£«ã®ãŸã‚ã®æœ€åˆã®æ³•å¾‹é›†ã ã‚ˆï¼' },
    ]
  },
  {
    id:'sengoku', name:'æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±', period:'15ã€œ16ä¸–ç´€',
    emoji:'âš”ï¸', color:'#cc2200', glow:'rgba(204,34,0,0.5)',
    char:'ç¹”ç”°ä¿¡é•·', charEmoji:'âš”ï¸',
    questions:[
      { q:'ã€Œæ¡¶ç‹­é–“ã®æˆ¦ã„ã€ã§ä»Šå·ç¾©å…ƒã‚’ç ´ã£ãŸæ­¦å°†ã¯ï¼Ÿ', choices:['è±Šè‡£ç§€å‰','å¾³å·å®¶åº·','æ­¦ç”°ä¿¡ç„','ç¹”ç”°ä¿¡é•·'], ans:3,
        hint:'å°‘ãªã„å…µåŠ›ã§å¤§è»ã«å¥‡è¥²ã‚’ã‹ã‘ãŸå¥‡è·¡ã®æˆ¦ã„ã ã‚ˆï¼' },
      { q:'ç¹”ç”°ä¿¡é•·ã®å¤©ä¸‹çµ±ä¸€ã‚’ç¶™ã„ã§å…¨å›½çµ±ä¸€ã‚’æœãŸã—ãŸäººç‰©ã¯ï¼Ÿ', choices:['å¾³å·å®¶åº·','è±Šè‡£ç§€å‰','æ˜æ™ºå…‰ç§€','æŸ´ç”°å‹å®¶'], ans:1,
        hint:'è¾²æ°‘å‡ºèº«ã§å¤©ä¸‹äººã«ãªã£ãŸç«‹å¿—ä¼ä¸­ã®äººç‰©ã ã‚ˆï¼' },
      { q:'æœ¬èƒ½å¯ºã®å¤‰ã§ç¹”ç”°ä¿¡é•·ã‚’è¥²ã£ãŸäººç‰©ã¯ï¼Ÿ', choices:['è±Šè‡£ç§€å‰','å¾³å·å®¶åº·','æ˜æ™ºå…‰ç§€','ä¸Šæ‰è¬™ä¿¡'], ans:2,
        hint:'ã€Œæ•µã¯æœ¬èƒ½å¯ºã«ã‚ã‚Šï¼ã€ã¨ã„ã†è¨€è‘‰ã§æœ‰åã ã‚ˆï¼' },
      { q:'è±Šè‡£ç§€å‰ãŒè¡Œã£ãŸè¾²æ°‘ã‹ã‚‰æ­¦å™¨ã‚’æ²¡åã—ãŸæ”¿ç­–ã¯ï¼Ÿ', choices:['å‚å‹¤äº¤ä»£','åˆ€ç‹©','å¤ªé–¤æ¤œåœ°','æ¥½å¸‚æ¥½åº§'], ans:1,
        hint:'è¾²æ°‘ã¨æ­¦å£«ã®èº«åˆ†ã‚’ã¯ã£ãã‚Šåˆ†ã‘ãŸæ”¿ç­–ã ã‚ˆï¼' },
      { q:'ç¹”ç”°ä¿¡é•·ãŒé‡è¦–ã—ãŸçµŒæ¸ˆæ”¿ç­–ã§ã€å¸‚å ´ã§ã®è‡ªç”±ãªå–å¼•ã‚’èªã‚ãŸã®ã¯ï¼Ÿ', choices:['å¤ªé–¤æ¤œåœ°','åˆ€ç‹©','æ¥½å¸‚æ¥½åº§','å‚å‹¤äº¤ä»£'], ans:2,
        hint:'å¸‚å ´ã®ç‹¬å ã‚’ãªãã—ã¦å•†æ¥­ã‚’æ´»ç™ºã«ã—ãŸæ”¿ç­–ã ã‚ˆï¼' },
    ]
  },
  {
    id:'edo', name:'æ±Ÿæˆ¸', period:'17ã€œ19ä¸–ç´€',
    emoji:'ğŸ—»', color:'#1a5a8a', glow:'rgba(26,90,138,0.5)',
    char:'å¾³å·å®¶åº·', charEmoji:'ğŸ—»',
    questions:[
      { q:'æ±Ÿæˆ¸å¹•åºœãŒé–å›½ä¸­ã«è²¿æ˜“ã‚’è¨±å¯ã—ã¦ã„ãŸå›½ã¯ï¼Ÿ', choices:['ã‚¹ãƒšã‚¤ãƒ³','ãƒãƒ«ãƒˆã‚¬ãƒ«','ã‚ªãƒ©ãƒ³ãƒ€','ã‚¤ã‚®ãƒªã‚¹'], ans:2,
        hint:'å‡ºå³¶ã¨ã„ã†äººå·¥å³¶ã§ã®ã¿è²¿æ˜“ãŒè¨±ã•ã‚Œã¦ã„ãŸã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸æ™‚ä»£ã«å‚å‹¤äº¤ä»£åˆ¶åº¦ã‚’æ•´å‚™ã—ãŸå°†è»ã¯ï¼Ÿ', choices:['å¾³å·å®¶åº·','å¾³å·å®¶å…‰','å¾³å·å‰å®—','å¾³å·æ…¶å–œ'], ans:1,
        hint:'3ä»£å°†è»ã§å¹•è—©ä½“åˆ¶ã‚’å›ºã‚ãŸäººç‰©ã ã‚ˆï¼' },
      { q:'1853å¹´ã«æ—¥æœ¬ã«é–‹å›½ã‚’æ±‚ã‚ã¦ã‚„ã£ã¦ããŸã‚¢ãƒ¡ãƒªã‚«ã®è»äººã¯ï¼Ÿ', choices:['ãƒãƒƒã‚«ãƒ¼ã‚µãƒ¼','ãƒšãƒªãƒ¼','ãƒãƒªã‚¹','ãƒ¯ã‚·ãƒ³ãƒˆãƒ³'], ans:1,
        hint:'ã€Œé»’èˆ¹æ¥èˆªã€ã§æœ‰åãªæç£ã ã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸æ™‚ä»£ã«åº¶æ°‘ã®å­ã©ã‚‚ãŸã¡ãŒé€šã£ãŸæ•™è‚²æ©Ÿé–¢ã¯ï¼Ÿ', choices:['å¤§å­¦','è—©æ ¡','å¯ºå­å±‹','å›½å­¦é™¢'], ans:2,
        hint:'èª­ã¿ãƒ»æ›¸ããƒ»ç®—ç›¤ã‚’æ•™ãˆãŸåº¶æ°‘ã®ãŸã‚ã®å­¦æ ¡ã ã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸å¹•åºœæœ€å¾Œã®å°†è»ã¯èª°ï¼Ÿ', choices:['å¾³å·æ…¶å–œ','å¾³å·å®¶èŒ‚','å¾³å·æ–‰æ˜­','å¾³å·å‰å®—'], ans:0,
        hint:'å¤§æ”¿å¥‰é‚„ã‚’è¡Œã„æ±Ÿæˆ¸æ™‚ä»£ã«å¹•ã‚’å¼•ã„ãŸå°†è»ã ã‚ˆï¼' },
    ]
  },
  {
    id:'meiji', name:'æ˜æ²»ãƒ»å¤§æ­£', period:'1868ã€œ1926',
    emoji:'ğŸŒ…', color:'#9a4a00', glow:'rgba(154,74,0,0.5)',
    char:'å‚æœ¬é¾é¦¬', charEmoji:'ğŸŒŠ',
    questions:[
      { q:'æ˜æ²»æ”¿åºœãŒæ–‡æ˜é–‹åŒ–ã‚’é€²ã‚ã‚‹ä¸­ã§1872å¹´ã«ç™ºå¸ƒã—ãŸæ•™è‚²ã«é–¢ã™ã‚‹æ³•ä»¤ã¯ï¼Ÿ', choices:['æ†²æ³•','å­¦åˆ¶','æ°‘æ³•','å¾´å…µä»¤'], ans:1,
        hint:'ã™ã¹ã¦ã®å›½æ°‘ãŒæ•™è‚²ã‚’å—ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸæ³•ä»¤ã ã‚ˆï¼' },
      { q:'1905å¹´ã®æ—¥éœ²æˆ¦äº‰ã®è¬›å’Œæ¡ç´„ã®åå‰ã¯ï¼Ÿ', choices:['ä¸‹é–¢æ¡ç´„','æ—¥ç±³å’Œè¦ªæ¡ç´„','ãƒãƒ¼ãƒ„ãƒã‚¹æ¡ç´„','æ—¥éŸ“ä½µåˆæ¡ç´„'], ans:2,
        hint:'ã‚¢ãƒ¡ãƒªã‚«ã®ãƒ«ãƒ¼ã‚ºãƒ™ãƒ«ãƒˆå¤§çµ±é ˜ãŒä»²ä»‹ã—ãŸã‚ˆï¼' },
      { q:'æ˜æ²»æ™‚ä»£ã«ã€Œå¯Œå›½å¼·å…µã€ã®ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã®ã‚‚ã¨é€²ã‚ã‚‰ã‚ŒãŸç”£æ¥­åŒ–æ”¿ç­–ã¯ï¼Ÿ', choices:['å»ƒè—©ç½®çœŒ','æ–‡æ˜é–‹åŒ–','æ®–ç”£èˆˆæ¥­','åœ°ç§Ÿæ”¹æ­£'], ans:2,
        hint:'å®˜å–¶å·¥å ´ã‚’å»ºè¨­ã—ã¦ç”£æ¥­ã‚’è‚²ã¦ãŸæ”¿ç­–ã ã‚ˆï¼' },
      { q:'1889å¹´ã«ç™ºå¸ƒã•ã‚ŒãŸæ—¥æœ¬åˆã®è¿‘ä»£çš„æ†²æ³•ã®åç§°ã¯ï¼Ÿ', choices:['æ—¥æœ¬å›½æ†²æ³•','å¤§æ—¥æœ¬å¸å›½æ†²æ³•','æ˜æ²»æ†²æ³•','å¸å›½æ†²æ³•'], ans:1,
        hint:'ä¼Šè—¤åšæ–‡ãŒä¸­å¿ƒã«ãªã£ã¦ä½œã£ãŸæ¬½å®šæ†²æ³•ã ã‚ˆï¼' },
      { q:'æ—¥æ¸…æˆ¦äº‰ã®è¬›å’Œæ¡ç´„ãŒçµã°ã‚ŒãŸå ´æ‰€ã¯ï¼Ÿ', choices:['æ±äº¬','ä¸‹é–¢','é•·å´','æ¨ªæµœ'], ans:1,
        hint:'å±±å£çœŒã®æ¸¯ç”ºã§æ¡ç´„ãŒèª¿å°ã•ã‚ŒãŸã‚ˆï¼' },
    ]
  },
  {
    id:'showa', name:'æ˜­å’Œãƒ»è¿‘ç¾ä»£', period:'1926ã€œ',
    emoji:'ğŸ•Šï¸', color:'#3a6a3a', glow:'rgba(58,106,58,0.5)',
    char:'æ±éƒ·å¹³å…«éƒ', charEmoji:'ğŸ•Šï¸',
    questions:[
      { q:'1945å¹´8æœˆ15æ—¥ã®å¤©çš‡ã«ã‚ˆã‚‹æ”¾é€ã§æ—¥æœ¬ãŒçµ‚æˆ¦ã‚’å‘Šã’ãŸã“ã®æ”¾é€ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['ç‹¬ç«‹å®£è¨€','ç‰éŸ³æ”¾é€','é™ä¼å®£è¨€','çµ‚æˆ¦è¨˜å¿µæ—¥'], ans:1,
        hint:'æ˜­å’Œå¤©çš‡ã®å£°ã§æˆ¦äº‰çµ‚çµãŒå›½æ°‘ã«ä¼ãˆã‚‰ã‚ŒãŸã‚ˆï¼' },
      { q:'1964å¹´ã«æ±äº¬ã§é–‹å‚¬ã•ã‚ŒãŸä¸–ç•Œçš„ã‚¹ãƒãƒ¼ãƒ„å¤§ä¼šã¯ï¼Ÿ', choices:['ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚«ãƒƒãƒ—','ãƒ©ã‚°ãƒ“ãƒ¼Wæ¯','æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯','ã‚¢ã‚¸ã‚¢å¤§ä¼š'], ans:2,
        hint:'é«˜åº¦çµŒæ¸ˆæˆé•·æœŸã®æ—¥æœ¬ã®å¾©èˆˆã‚’ä¸–ç•Œã«ç¤ºã—ãŸå¤§ä¼šã ã‚ˆï¼' },
      { q:'å¤ªå¹³æ´‹æˆ¦äº‰é–‹æˆ¦ã®ãã£ã‹ã‘ã¨ãªã£ãŸ1941å¹´ã®æ”»æ’ƒã®å ´æ‰€ã¯ï¼Ÿ', choices:['ã‚°ã‚¢ãƒ ','ãƒ•ã‚£ãƒªãƒ”ãƒ³','çœŸç æ¹¾','ãƒŸãƒƒãƒ‰ã‚¦ã‚§ãƒ¼'], ans:2,
        hint:'ãƒãƒ¯ã‚¤ã®ã‚¢ãƒ¡ãƒªã‚«æµ·è»åŸºåœ°ã¸ã®å¥‡è¥²æ”»æ’ƒã ã‚ˆï¼' },
      { q:'1951å¹´ã«çµã°ã‚ŒãŸæ—¥æœ¬ã®ä¸»æ¨©å›å¾©ã‚’å®šã‚ãŸæ¡ç´„ã¯ï¼Ÿ', choices:['æ—¥ç±³å®‰ä¿æ¡ç´„','ã‚µãƒ³ãƒ•ãƒ©ãƒ³ã‚·ã‚¹ã‚³å¹³å’Œæ¡ç´„','æ—¥ä¸­å¹³å’Œå‹å¥½æ¡ç´„','æ—¥ã‚½ä¸­ç«‹æ¡ç´„'], ans:1,
        hint:'GHQã«ã‚ˆã‚‹å é ˜ãŒçµ‚ã‚ã‚Šã‚’å‘Šã’ãŸæ¡ç´„ã ã‚ˆï¼' },
      { q:'æˆ¦å¾Œã®é«˜åº¦çµŒæ¸ˆæˆé•·æœŸã«æ—¥æœ¬ãŒé”æˆã—ãŸGNPä¸–ç•Œç¬¬2ä½ã«ãªã£ãŸã®ã¯ã„ã¤é ƒï¼Ÿ', choices:['1950å¹´ä»£','1960å¹´ä»£','1970å¹´ä»£','1980å¹´ä»£'], ans:1,
        hint:'æ–°å¹¹ç·šé–‹æ¥­ã‚„æ±äº¬äº”è¼ªã‚‚åŒã˜æ™‚ä»£ã ã‚ˆï¼' },
    ]
  },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentEra = null;
let currentQuestions = [];
let currentQIndex = 0;
let score = 0;
let correctCount = 0;
let combo = 0;
let timerInterval = null;
let timeLeft = 20;
let answered = false;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCREEN NAVIGATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showTitle() { showScreen('screen-title'); }

function showEraSelect() {
  showScreen('screen-era');
  renderEraList();
}

function renderEraList() {
  const tl = document.getElementById('eraTimeline');
  tl.innerHTML = '';
  ERAS.forEach(era => {
    const item = document.createElement('div');
    item.className = 'era-item';
    item.innerHTML = `
      <div class="era-dot" style="border-color:${era.color};background:rgba(${hexToRgb(era.color)},0.15);box-shadow:0 0 12px ${era.glow}">
        <span>${era.emoji}</span>
      </div>
      <div class="era-card">
        <div class="era-card-name">${era.name}</div>
        <div class="era-card-period">${era.period}</div>
        <div class="era-card-count">${era.questions.length}å•</div>
        <div class="era-card-bar" style="background:${era.color};width:0"></div>
      </div>
    `;
    item.addEventListener('click', () => startQuiz(era));
    tl.appendChild(item);
  });
}

function hexToRgb(hex) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `${r},${g},${b}`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// QUIZ LOGIC
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startQuiz(era) {
  currentEra = era;
  currentQuestions = shuffle([...era.questions]).slice(0, 5);
  currentQIndex = 0;
  score = 0;
  correctCount = 0;
  combo = 0;

  document.getElementById('quizEraLabel').textContent = era.name;
  document.getElementById('quizCharEmoji').textContent = era.charEmoji;
  document.getElementById('quizCharName').textContent = era.char;

  showScreen('screen-quiz');
  renderQuestion();
}

function renderQuestion() {
  clearTimer();
  answered = false;

  const q = currentQuestions[currentQIndex];
  document.getElementById('qNumber').textContent = `å•${currentQIndex + 1} / ${currentQuestions.length}`;
  document.getElementById('qText').textContent = q.q;
  document.getElementById('scoreDisplay').textContent = score;

  const area = document.getElementById('choicesArea');
  area.innerHTML = '';
  const labels = ['ï¼¡','ï¼¢','ï¼£','ï¼¤'];
  q.choices.forEach((c, i) => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.innerHTML = `<span class="choice-label">${labels[i]}</span>${c}`;
    btn.addEventListener('click', () => selectAnswer(i, q.ans, q.hint));
    area.appendChild(btn);
  });

  startTimer();
}

function startTimer() {
  timeLeft = 20;
  updateTimerUI();
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerUI();
    if (timeLeft <= 0) {
      clearTimer();
      if (!answered) timeUp();
    }
  }, 1000);
}

function updateTimerUI() {
  const pct = (timeLeft / 20) * 100;
  const bar = document.getElementById('timerBar');
  bar.style.width = pct + '%';
  if (pct < 30) bar.style.background = 'var(--red)';
  else if (pct < 60) bar.style.background = 'linear-gradient(90deg,#ff8800,var(--accent))';
  else bar.style.background = 'linear-gradient(90deg,var(--gold),var(--accent))';
  document.getElementById('timerText').textContent = timeLeft + 'ç§’';
}

function clearTimer() {
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
}

function timeUp() {
  answered = true;
  combo = 0;
  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach((b, i) => {
    b.classList.add('disabled');
    if (i === currentQuestions[currentQIndex].ans) b.classList.add('correct');
  });
  setTimeout(nextQuestion, 1500);
}

function selectAnswer(selected, correct, hint) {
  if (answered) return;
  answered = true;
  clearTimer();

  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach(b => b.classList.add('disabled'));

  if (selected === correct) {
    btns[selected].classList.add('correct');
    correctCount++;
    combo++;
    const pts = 100 + (timeLeft * 5) + (combo > 1 ? combo * 20 : 0);
    score += pts;
    spawnParticles(btns[selected]);
    if (combo >= 2) showCombo(combo);
  } else {
    btns[selected].classList.add('wrong');
    btns[correct].classList.add('correct');
    combo = 0;
  }

  document.getElementById('scoreDisplay').textContent = score;
  setTimeout(nextQuestion, 1600);
}

function nextQuestion() {
  currentQIndex++;
  if (currentQIndex >= currentQuestions.length) {
    showResult();
  } else {
    renderQuestion();
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COMBO
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showCombo(n) {
  const el = document.getElementById('comboFlash');
  const texts = { 2:'COMBO!', 3:'GREAT!!', 4:'AMAZING!!!', 5:'PERFECT!!!!' };
  const colors = { 2:var_gold(), 3:'#ff8800', 4:'#ff4422', 5:'#ff00ff' };
  el.textContent = texts[n] || `${n}é€£ç¶šï¼`;
  el.style.color = colors[n] || '#ff00ff';
  el.classList.remove('show');
  void el.offsetWidth;
  el.classList.add('show');
}
function var_gold() { return '#ffcc00'; }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PARTICLES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spawnParticles(el) {
  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  for (let i = 0; i < 12; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const angle = (i / 12) * 360;
    const dist = 60 + Math.random() * 60;
    const tx = Math.cos(angle * Math.PI/180) * dist;
    const ty = Math.sin(angle * Math.PI/180) * dist;
    p.style.cssText = `left:${cx}px;top:${cy}px;background:${['#ffcc00','#ff4422','#00c864'][i%3]};--tx:${tx}px;--ty:${ty}px;`;
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 1000);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RESULT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult() {
  showScreen('screen-result');
  const pct = correctCount / currentQuestions.length;
  let rank, title;
  if (pct === 1)      { rank = 'ğŸ†'; title = 'å¤©ã€€ä¸‹ã€€äºº'; }
  else if (pct >= 0.8){ rank = 'â­â­'; title = 'æ­´å²ã®ä½¿ã„æ‰‹'; }
  else if (pct >= 0.6){ rank = 'â­'; title = 'æ­´å²ã®è¦‹ç¿’ã„'; }
  else if (pct >= 0.4){ rank = 'ğŸ“š'; title = 'ã¾ã ã¾ã ä¿®è¡Œä¸­'; }
  else                { rank = 'ğŸ’€'; title = 'æ•—è€…å¾©æ´»ã‚’ç‹™ãˆï¼'; }

  document.getElementById('resultRank').textContent = rank;
  document.getElementById('resultTitle').textContent = title;
  document.getElementById('resultScore').textContent = score;
  document.getElementById('resultCorrect').textContent =
    `${currentQuestions.length}å•ä¸­ ${correctCount}å•æ­£è§£`;
  document.getElementById('unlockedEmoji').textContent = currentEra.charEmoji;
  document.getElementById('unlockedName').textContent = currentEra.char;
}

function replayQuiz() { startQuiz(currentEra); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SERVICE WORKER ç™»éŒ²
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js")
      .then(() => console.log("SWç™»éŒ²å®Œäº†"))
      .catch((e) => console.log("SWç™»éŒ²å¤±æ•—:", e));
  });
}
</script>
</body>
</html>
