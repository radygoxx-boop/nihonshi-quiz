<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>æ­´å²ãƒãƒˆãƒ«ï¼ãƒ‹ãƒƒãƒãƒ³å²ã‚¯ã‚¤ã‚º</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ãƒ‹ãƒƒãƒãƒ³å²">
  <meta name="theme-color" content="#0a0a12">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Zen+Antique+Soft&family=Noto+Sans+JP:wght@400;700;900&display=swap');

  :root {
    --ink: #0a0a12;
    --paper: #f5f0e8;
    --red: #cc2200;
    --gold: #d4a017;
    --blue: #1a3a6b;
    --accent: #ff4422;
    --glow: #ffcc00;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; width: 100%; max-width: 420px; min-height: 100vh; position: relative; }
  .screen.active { display: flex; flex-direction: column; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TITLE SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-title {
    background: linear-gradient(160deg, #0a0a12 0%, #1a0a05 60%, #0a0010 100%);
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    position: relative;
    overflow: hidden;
  }

  .title-bg-lines {
    position: absolute; inset: 0; pointer-events: none;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 48px,
      rgba(212,160,23,0.06) 48px, rgba(212,160,23,0.06) 49px
    ),
    repeating-linear-gradient(
      90deg, transparent, transparent 48px,
      rgba(212,160,23,0.04) 48px, rgba(212,160,23,0.04) 49px
    );
  }

  .title-seal {
    width: 90px; height: 90px;
    border: 3px solid var(--gold);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 24px;
    position: relative;
    animation: rotateSeal 20s linear infinite;
    box-shadow: 0 0 30px rgba(212,160,23,0.4), inset 0 0 20px rgba(212,160,23,0.1);
  }
  .title-seal::before {
    content: '';
    position: absolute; inset: 5px;
    border: 1px solid rgba(212,160,23,0.4);
    border-radius: 50%;
  }
  .title-seal-kanji {
    font-family: 'Zen Antique Soft', serif;
    font-size: 36px; color: var(--gold);
    text-shadow: 0 0 20px rgba(212,160,23,0.8);
  }
  @keyframes rotateSeal { to { transform: rotate(360deg); } }

  .title-eyebrow {
    font-size: 11px; letter-spacing: 0.4em; color: var(--gold);
    text-transform: uppercase; margin-bottom: 12px;
    opacity: 0.8;
  }

  .title-main {
    font-family: 'Zen Antique Soft', serif;
    font-size: 42px; line-height: 1.1;
    color: var(--paper);
    text-align: center;
    text-shadow: 4px 4px 0 var(--red), 0 0 40px rgba(204,34,0,0.4);
    margin-bottom: 8px;
    animation: titlePulse 3s ease-in-out infinite;
  }
  @keyframes titlePulse {
    0%,100% { text-shadow: 4px 4px 0 var(--red), 0 0 40px rgba(204,34,0,0.3); }
    50% { text-shadow: 4px 4px 0 var(--red), 0 0 60px rgba(204,34,0,0.6), 0 0 100px rgba(255,68,34,0.2); }
  }

  .title-sub {
    font-size: 13px; color: rgba(245,240,232,0.6);
    letter-spacing: 0.15em; margin-bottom: 40px;
    text-align: center;
  }

  /* Character illustration area */
  .title-chars {
    display: flex; justify-content: center; gap: 0;
    margin-bottom: 40px;
    position: relative;
  }

  .char-card {
    width: 90px; height: 130px;
    position: relative;
    cursor: default;
  }
  .char-card:nth-child(1) { transform: rotate(-8deg) translateX(10px); z-index: 1; }
  .char-card:nth-child(2) { transform: translateY(-10px); z-index: 3; }
  .char-card:nth-child(3) { transform: rotate(8deg) translateX(-10px); z-index: 1; }

  .char-avatar {
    width: 100%; height: 100%;
    border-radius: 8px;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    font-family: 'Zen Antique Soft', serif;
    border: 2px solid;
    position: relative;
    overflow: hidden;
  }
  .char-card:nth-child(1) .char-avatar { background: linear-gradient(160deg,#1a0050,#0a002a); border-color: #7b2fff; }
  .char-card:nth-child(2) .char-avatar { background: linear-gradient(160deg,#4a0000,#200000); border-color: var(--red); box-shadow: 0 0 20px rgba(204,34,0,0.5); }
  .char-card:nth-child(3) .char-avatar { background: linear-gradient(160deg,#002a4a,#00101a); border-color: #00aaff; }

  .char-emoji { font-size: 44px; line-height: 1; margin-bottom: 4px; }
  .char-name-tag {
    font-size: 9px; color: rgba(255,255,255,0.7);
    letter-spacing: 0.05em; text-align: center;
    padding: 0 4px;
  }
  .char-era-badge {
    position: absolute; bottom: 6px; left: 0; right: 0;
    text-align: center; font-size: 8px;
    color: rgba(255,255,255,0.5);
  }

  .speed-lines {
    position: absolute; inset: -20px; pointer-events: none;
    background: repeating-conic-gradient(
      rgba(255,255,255,0.02) 0deg 5deg,
      transparent 5deg 10deg
    );
    border-radius: 50%;
    animation: spinLines 8s linear infinite;
  }
  @keyframes spinLines { to { transform: rotate(360deg); } }

  .start-btn {
    background: var(--red);
    color: white;
    border: none; border-radius: 4px;
    padding: 18px 48px;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 18px; font-weight: 900;
    letter-spacing: 0.1em;
    cursor: pointer;
    position: relative; overflow: hidden;
    box-shadow: 0 6px 0 #7a1100, 0 8px 20px rgba(204,34,0,0.4);
    transition: transform 0.1s, box-shadow 0.1s;
    clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  }
  .start-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #7a1100; }
  .start-btn::after {
    content: '';
    position: absolute; top: 0; left: -100%;
    width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: btnShine 2.5s ease-in-out infinite;
  }
  @keyframes btnShine { to { left: 200%; } }

  .version-tag {
    position: absolute; bottom: 20px;
    font-size: 10px; color: rgba(245,240,232,0.3);
    letter-spacing: 0.2em;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ERA SELECT SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-era {
    background: #0d0d18;
    padding: 0;
    overflow-y: auto;
  }

  .era-header {
    background: linear-gradient(180deg, #0a0a12, transparent);
    padding: 24px 20px 16px;
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(10px);
  }
  .era-header-top {
    display: flex; align-items: center; gap: 12px; margin-bottom: 4px;
  }
  .back-btn {
    background: none; border: 1px solid rgba(245,240,232,0.2);
    color: rgba(245,240,232,0.7); border-radius: 4px;
    padding: 6px 10px; cursor: pointer; font-size: 12px;
    font-family: 'Noto Sans JP', sans-serif;
  }
  .era-header h2 {
    font-family: 'Zen Antique Soft', serif;
    font-size: 20px; color: var(--paper);
  }
  .era-header p {
    font-size: 11px; color: rgba(245,240,232,0.4); letter-spacing: 0.1em;
  }

  .era-timeline {
    padding: 16px 20px 40px;
    position: relative;
  }
  .era-timeline::before {
    content: '';
    position: absolute; left: 36px; top: 20px; bottom: 40px;
    width: 2px;
    background: linear-gradient(180deg, var(--gold), rgba(212,160,23,0.1));
  }

  .era-item {
    display: flex; align-items: center; gap: 16px;
    margin-bottom: 12px;
    cursor: pointer;
    animation: fadeSlideIn 0.3s ease both;
  }
  .era-item:nth-child(1) { animation-delay: 0.05s; }
  .era-item:nth-child(2) { animation-delay: 0.1s; }
  .era-item:nth-child(3) { animation-delay: 0.15s; }
  .era-item:nth-child(4) { animation-delay: 0.2s; }
  .era-item:nth-child(5) { animation-delay: 0.25s; }
  .era-item:nth-child(6) { animation-delay: 0.3s; }
  .era-item:nth-child(7) { animation-delay: 0.35s; }
  .era-item:nth-child(8) { animation-delay: 0.4s; }
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .era-dot {
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0; position: relative; z-index: 1;
    border: 2px solid;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .era-item:hover .era-dot { transform: scale(1.2); }
  .era-item:hover .era-card { transform: translateX(4px); }

  .era-card {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px;
    padding: 12px 16px;
    transition: background 0.2s, transform 0.2s, border-color 0.2s;
    position: relative; overflow: hidden;
  }
  .era-item:hover .era-card {
    background: rgba(255,255,255,0.08);
    border-color: rgba(255,255,255,0.2);
  }
  .era-card-name {
    font-family: 'Zen Antique Soft', serif;
    font-size: 16px; color: var(--paper); margin-bottom: 2px;
  }
  .era-card-period {
    font-size: 10px; color: rgba(245,240,232,0.4); letter-spacing: 0.1em;
  }
  .era-card-count {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    font-size: 10px; color: rgba(245,240,232,0.3);
  }
  .era-card-bar {
    position: absolute; bottom: 0; left: 0;
    height: 2px; border-radius: 0 0 8px 8px;
    transition: width 0.4s ease;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     QUIZ SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-quiz {
    background: #0d0d18;
    padding: 0;
  }

  .quiz-topbar {
    padding: 16px 20px 12px;
    display: flex; align-items: center; gap: 12px;
    background: rgba(10,10,18,0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .quiz-era-label {
    font-size: 11px; color: var(--gold); letter-spacing: 0.1em;
    font-weight: 700; flex: 1;
  }
  .quiz-score-display {
    font-family: 'Zen Antique Soft', serif;
    font-size: 18px; color: var(--paper);
  }
  .quiz-score-display span { color: var(--gold); font-size: 22px; }

  .timer-bar-wrap {
    padding: 0 20px 0;
  }
  .timer-bar-bg {
    height: 6px; background: rgba(255,255,255,0.08);
    border-radius: 3px; overflow: hidden; margin-top: 8px;
  }
  .timer-bar-fill {
    height: 100%; border-radius: 3px;
    background: linear-gradient(90deg, var(--gold), var(--accent));
    transition: width 1s linear, background 0.3s;
  }
  .timer-text {
    font-size: 11px; color: rgba(245,240,232,0.4);
    text-align: right; margin-top: 2px;
  }

  .quiz-char-area {
    padding: 16px 20px 0;
    display: flex; align-items: flex-end; gap: 16px;
    min-height: 160px;
  }
  .quiz-char-figure {
    width: 100px; flex-shrink: 0;
    display: flex; flex-direction: column; align-items: center;
  }
  .quiz-char-emoji {
    font-size: 72px; line-height: 1;
    filter: drop-shadow(0 0 20px rgba(255,200,0,0.3));
    animation: charFloat 3s ease-in-out infinite;
  }
  @keyframes charFloat {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  .quiz-char-name {
    font-size: 10px; color: rgba(245,240,232,0.5);
    margin-top: 4px; letter-spacing: 0.05em;
  }

  .speech-bubble {
    flex: 1;
    background: rgba(245,240,232,0.06);
    border: 1px solid rgba(245,240,232,0.12);
    border-radius: 12px 12px 12px 4px;
    padding: 14px 16px;
    position: relative;
  }
  .speech-bubble::before {
    content: '';
    position: absolute; left: -8px; bottom: 20px;
    border: 8px solid transparent;
    border-right-color: rgba(245,240,232,0.12);
  }
  .speech-bubble-inner::after {
    content: '';
    position: absolute; left: -6px; bottom: 21px;
    border: 7px solid transparent;
    border-right-color: rgba(245,240,232,0.06);
  }

  .q-number {
    font-size: 10px; color: var(--gold); letter-spacing: 0.1em;
    font-weight: 700; margin-bottom: 8px;
  }
  .q-text {
    font-size: 15px; line-height: 1.7;
    color: var(--paper);
    font-weight: 700;
  }

  .choices-area {
    padding: 20px 20px 30px;
    display: flex; flex-direction: column; gap: 10px;
  }

  .choice-btn {
    background: rgba(255,255,255,0.05);
    border: 1.5px solid rgba(255,255,255,0.12);
    border-radius: 8px;
    padding: 14px 18px;
    color: var(--paper);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 14px; font-weight: 700;
    text-align: left;
    cursor: pointer;
    display: flex; align-items: center; gap: 12px;
    transition: background 0.15s, border-color 0.15s, transform 0.1s;
    position: relative; overflow: hidden;
  }
  .choice-btn:not(.disabled):hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.25);
    transform: translateX(4px);
  }
  .choice-btn:not(.disabled):active { transform: scale(0.98); }

  .choice-label {
    width: 26px; height: 26px; border-radius: 50%;
    background: rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 900; flex-shrink: 0;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .choice-btn.correct {
    background: rgba(0,200,100,0.15);
    border-color: #00c864;
    animation: correctPulse 0.4s ease;
  }
  .choice-btn.correct .choice-label { background: #00c864; border-color: #00c864; }
  @keyframes correctPulse {
    0% { transform: scale(1); }
    40% { transform: scale(1.03); }
    100% { transform: scale(1); }
  }

  .choice-btn.wrong {
    background: rgba(204,34,0,0.15);
    border-color: var(--red);
    animation: wrongShake 0.4s ease;
  }
  .choice-btn.wrong .choice-label { background: var(--red); border-color: var(--red); }
  @keyframes wrongShake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .choice-btn.disabled { cursor: default; }

  /* Combo flash */
  .combo-flash {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
    font-family: 'Zen Antique Soft', serif;
    font-size: 64px; font-weight: 900;
    pointer-events: none; z-index: 100;
    opacity: 0;
    text-shadow: 0 0 30px currentColor;
  }
  .combo-flash.show {
    animation: comboAnim 0.8s ease forwards;
  }
  @keyframes comboAnim {
    0% { opacity: 0; transform: translate(-50%,-50%) scale(0.3) rotate(-10deg); }
    30% { opacity: 1; transform: translate(-50%,-50%) scale(1.2) rotate(3deg); }
    60% { opacity: 1; transform: translate(-50%,-50%) scale(1) rotate(0deg); }
    100% { opacity: 0; transform: translate(-50%,-50%) scale(1.1) rotate(0deg) translateY(-30px); }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULT SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-result {
    background: linear-gradient(160deg, #0a0a12 0%, #1a0a05 60%, #0a0010 100%);
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    text-align: center;
    position: relative; overflow: hidden;
  }

  .result-burst {
    position: absolute; inset: 0; pointer-events: none;
    background: repeating-conic-gradient(
      rgba(212,160,23,0.03) 0deg 10deg,
      transparent 10deg 20deg
    );
    animation: spinLines 15s linear infinite;
  }

  .result-rank {
    font-family: 'Zen Antique Soft', serif;
    font-size: 80px; line-height: 1;
    margin-bottom: 8px;
    animation: rankAppear 0.6s cubic-bezier(0.175,0.885,0.32,1.275) both;
  }
  @keyframes rankAppear {
    from { opacity: 0; transform: scale(0); }
    to { opacity: 1; transform: scale(1); }
  }

  .result-title-label {
    font-size: 12px; color: var(--gold); letter-spacing: 0.3em;
    margin-bottom: 4px;
  }
  .result-title-text {
    font-family: 'Zen Antique Soft', serif;
    font-size: 28px; color: var(--paper); margin-bottom: 24px;
  }

  .result-score-box {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px 40px;
    margin-bottom: 32px;
  }
  .result-score-num {
    font-family: 'Zen Antique Soft', serif;
    font-size: 56px; color: var(--gold);
    text-shadow: 0 0 30px rgba(212,160,23,0.6);
    line-height: 1;
  }
  .result-score-label { font-size: 12px; color: rgba(245,240,232,0.5); margin-top: 4px; }
  .result-correct-count { font-size: 14px; color: rgba(245,240,232,0.6); margin-top: 8px; }

  .result-char-unlocked {
    background: rgba(212,160,23,0.1);
    border: 1px solid rgba(212,160,23,0.3);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 32px;
    display: flex; align-items: center; gap: 12px;
  }
  .result-char-unlocked-emoji { font-size: 48px; }
  .result-char-unlocked-text { text-align: left; }
  .result-char-unlocked-label {
    font-size: 10px; color: var(--gold); letter-spacing: 0.2em; margin-bottom: 4px;
  }
  .result-char-unlocked-name {
    font-family: 'Zen Antique Soft', serif;
    font-size: 18px; color: var(--paper);
  }

  .result-btns { display: flex; flex-direction: column; gap: 12px; width: 100%; }
  .result-btn-primary {
    background: var(--red); color: white;
    border: none; border-radius: 4px; padding: 16px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 16px; font-weight: 900;
    cursor: pointer;
    box-shadow: 0 4px 0 #7a1100;
    transition: transform 0.1s, box-shadow 0.1s;
    clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  }
  .result-btn-primary:active { transform: translateY(3px); box-shadow: 0 1px 0 #7a1100; }
  .result-btn-secondary {
    background: transparent; color: rgba(245,240,232,0.6);
    border: 1px solid rgba(245,240,232,0.15); border-radius: 4px; padding: 14px;
    font-family: 'Noto Sans JP', sans-serif; font-size: 14px; font-weight: 700;
    cursor: pointer;
    transition: border-color 0.2s, color 0.2s;
  }
  .result-btn-secondary:hover { border-color: rgba(245,240,232,0.4); color: var(--paper); }

  /* particles */
  .particle {
    position: fixed; pointer-events: none; z-index: 50;
    width: 8px; height: 8px; border-radius: 50%;
    animation: particleFly 1s ease forwards;
  }
  @keyframes particleFly {
    to { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
  }

  /* â”€â”€ ç®¡ç†ãƒœã‚¿ãƒ³ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼‰ â”€â”€ */
  .admin-entry-btn {
    position: absolute; bottom: 52px; right: 20px;
    background: none; border: 1px solid rgba(245,240,232,0.12);
    color: rgba(245,240,232,0.25); border-radius: 4px;
    padding: 5px 9px; font-size: 10px; letter-spacing: 0.1em;
    font-family: "Noto Sans JP", sans-serif;
    cursor: pointer; transition: all 0.2s;
  }
  .admin-entry-btn:hover { border-color: rgba(245,240,232,0.4); color: rgba(245,240,232,0.6); }

  #screen-password {
    background: linear-gradient(160deg, #0a0a12 0%, #0a0018 100%);
    align-items: center; justify-content: center;
    padding: 40px 24px; text-align: center;
  }
  .pw-icon { font-size: 48px; margin-bottom: 16px; }
  .pw-title { font-family: "Zen Antique Soft", serif; font-size: 22px; color: var(--paper); margin-bottom: 6px; }
  .pw-sub { font-size: 11px; color: rgba(245,240,232,0.4); letter-spacing: 0.1em; margin-bottom: 32px; }
  .pw-input-wrap { position: relative; width: 100%; margin-bottom: 10px; }
  .pw-input {
    width: 100%; padding: 16px 48px 16px 18px;
    background: rgba(255,255,255,0.06); border: 1.5px solid rgba(255,255,255,0.15);
    border-radius: 8px; color: var(--paper);
    font-family: "Noto Sans JP", sans-serif; font-size: 16px;
    outline: none; transition: border-color 0.2s; letter-spacing: 0.15em;
  }
  .pw-input:focus { border-color: var(--gold); }
  .pw-input.error { border-color: var(--red); animation: wrongShake 0.4s ease; }
  .pw-toggle {
    position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
    background: none; border: none; color: rgba(245,240,232,0.4);
    cursor: pointer; font-size: 18px; padding: 4px;
  }
  .pw-submit-btn {
    width: 100%; padding: 16px;
    background: var(--blue); color: white; border: none; border-radius: 8px;
    font-family: "Noto Sans JP", sans-serif; font-size: 16px; font-weight: 900;
    cursor: pointer; transition: background 0.2s; margin-bottom: 16px;
  }
  .pw-submit-btn:hover { background: #1e4a8a; }
  .pw-error-msg { font-size: 12px; color: var(--red); min-height: 18px; margin-bottom: 8px; }
  .pw-back-btn {
    background: none; border: none; color: rgba(245,240,232,0.4);
    font-family: "Noto Sans JP", sans-serif; font-size: 13px;
    cursor: pointer; text-decoration: underline;
  }

  #screen-admin { background: #0d0d18; overflow-y: auto; }
  .admin-header {
    background: rgba(10,10,18,0.95); padding: 20px 20px 14px;
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(212,160,23,0.2);
  }
  .admin-header-top { display: flex; align-items: center; gap: 12px; margin-bottom: 2px; }
  .admin-header h2 { font-family: "Zen Antique Soft", serif; font-size: 18px; color: var(--gold); flex: 1; }
  .admin-header-sub { font-size: 10px; color: rgba(245,240,232,0.35); letter-spacing: 0.1em; }
  .admin-stats { display: flex; gap: 10px; padding: 14px 20px 0; }
  .admin-stat-card {
    flex: 1; background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px; padding: 10px 12px; text-align: center;
  }
  .admin-stat-num { font-family: "Zen Antique Soft", serif; font-size: 24px; color: var(--gold); }
  .admin-stat-label { font-size: 9px; color: rgba(245,240,232,0.4); margin-top: 2px; }
  .admin-section { padding: 20px 20px 0; }
  .admin-section-title {
    font-size: 11px; color: var(--gold); letter-spacing: 0.2em; font-weight: 700;
    margin-bottom: 12px; display: flex; align-items: center; gap: 8px;
  }
  .admin-section-title::after { content: ""; flex: 1; height: 1px; background: rgba(212,160,23,0.2); }
  .admin-form { display: flex; flex-direction: column; gap: 10px; }
  .form-group { display: flex; flex-direction: column; gap: 4px; }
  .form-label { font-size: 10px; color: rgba(245,240,232,0.5); letter-spacing: 0.1em; font-weight: 700; }
  .form-input, .form-select, .form-textarea {
    background: rgba(255,255,255,0.06); border: 1.5px solid rgba(255,255,255,0.12);
    border-radius: 6px; color: var(--paper);
    font-family: "Noto Sans JP", sans-serif; font-size: 14px;
    padding: 10px 12px; outline: none; transition: border-color 0.2s;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--gold); }
  .form-textarea { resize: vertical; min-height: 70px; line-height: 1.6; }
  .form-select option { background: #1a1a2e; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .choice-input-wrap { position: relative; }
  .choice-input-label {
    position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
    font-size: 11px; font-weight: 900; color: rgba(245,240,232,0.4); pointer-events: none;
  }
  .choice-input {
    width: 100%; padding: 10px 10px 10px 28px;
    background: rgba(255,255,255,0.06); border: 1.5px solid rgba(255,255,255,0.12);
    border-radius: 6px; color: var(--paper);
    font-family: "Noto Sans JP", sans-serif; font-size: 13px;
    outline: none; transition: border-color 0.2s;
  }
  .choice-input:focus { border-color: var(--gold); }
  .choice-input.is-answer { border-color: #00c864; background: rgba(0,200,100,0.08); }
  .admin-submit-btn {
    width: 100%; padding: 16px; background: var(--red); color: white;
    border: none; border-radius: 6px; font-family: "Noto Sans JP", sans-serif;
    font-size: 16px; font-weight: 900; cursor: pointer; margin-top: 6px;
    box-shadow: 0 4px 0 #7a1100; transition: transform 0.1s, box-shadow 0.1s;
    clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
  }
  .admin-submit-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #7a1100; }
  .admin-q-list { display: flex; flex-direction: column; gap: 8px; padding: 16px 20px 40px; }
  .admin-q-item {
    background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px; padding: 12px 14px; display: flex; gap: 12px; align-items: flex-start;
  }
  .admin-q-era-badge {
    font-size: 9px; padding: 3px 7px; border-radius: 99px; border: 1px solid;
    white-space: nowrap; flex-shrink: 0; margin-top: 2px;
  }
  .admin-q-text-wrap { flex: 1; min-width: 0; }
  .admin-q-text { font-size: 13px; color: var(--paper); line-height: 1.5; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .admin-q-meta { font-size: 10px; color: rgba(245,240,232,0.35); margin-top: 3px; }
  .admin-q-delete { background: none; border: none; color: rgba(245,240,232,0.25); cursor: pointer; font-size: 16px; padding: 2px 4px; transition: color 0.2s; flex-shrink: 0; }
  .admin-q-delete:hover { color: var(--red); }
  .admin-empty { text-align: center; padding: 30px 20px; color: rgba(245,240,232,0.25); font-size: 13px; }
  .toast {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(80px);
    background: #00c864; color: white; padding: 12px 24px; border-radius: 99px;
    font-family: "Noto Sans JP", sans-serif; font-size: 14px; font-weight: 700;
    z-index: 200; transition: transform 0.3s ease; white-space: nowrap;
    box-shadow: 0 4px 20px rgba(0,200,100,0.4);
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.error-toast { background: var(--red); box-shadow: 0 4px 20px rgba(204,34,0,0.4); }

  /* â”€â”€ å›³é‘‘ãƒœã‚¿ãƒ³ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼‰ â”€â”€ */
  .zukan-btn {
    background: linear-gradient(135deg, #1a1a3e, #2a0a3e);
    border: 2px solid var(--gold);
    color: var(--gold);
    border-radius: 8px;
    padding: 14px 32px;
    font-family: "Zen Antique Soft", serif;
    font-size: 18px; letter-spacing: 0.2em;
    cursor: pointer;
    box-shadow: 0 0 16px rgba(212,160,23,0.3);
    transition: all 0.2s;
    margin-bottom: 12px;
    width: 100%;
  }
  .zukan-btn:hover { box-shadow: 0 0 28px rgba(212,160,23,0.6); transform: translateY(-2px); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ZUKAN (å›³é‘‘) SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #screen-zukan {
    background: linear-gradient(160deg, #05050f 0%, #0a0520 60%, #05050f 100%);
    overflow-y: auto;
  }
  .zukan-header {
    background: rgba(5,5,15,0.95);
    padding: 20px 20px 14px;
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(212,160,23,0.25);
  }
  .zukan-header-top { display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
  .zukan-header h2 {
    font-family: "Zen Antique Soft", serif;
    font-size: 20px; color: var(--gold); flex: 1;
  }
  .zukan-header-sub { font-size: 10px; color: rgba(245,240,232,0.35); letter-spacing: 0.15em; }
  .zukan-progress-bar-wrap {
    margin-top: 10px;
    background: rgba(255,255,255,0.06);
    border-radius: 99px; height: 6px; overflow: hidden;
  }
  .zukan-progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), #ffcc44);
    border-radius: 99px;
    transition: width 0.6s ease;
  }
  .zukan-progress-label {
    font-size: 11px; color: rgba(245,240,232,0.5);
    margin-top: 5px; text-align: right;
  }

  /* ã‚°ãƒªãƒƒãƒ‰ */
  .zukan-era-section { padding: 20px 16px 4px; }
  .zukan-era-title {
    font-family: "Zen Antique Soft", serif;
    font-size: 13px; letter-spacing: 0.15em;
    margin-bottom: 12px;
    display: flex; align-items: center; gap: 8px;
  }
  .zukan-era-title::after {
    content: ""; flex: 1; height: 1px;
    background: rgba(255,255,255,0.1);
  }
  .zukan-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding-bottom: 8px;
  }

  /* ã‚­ãƒ£ãƒ©ã‚«ãƒ¼ãƒ‰ */
  .zukan-card {
    border-radius: 12px;
    border: 1.5px solid rgba(255,255,255,0.08);
    overflow: hidden;
    position: relative;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    background: rgba(255,255,255,0.03);
  }
  .zukan-card.unlocked {
    border-color: rgba(212,160,23,0.4);
    box-shadow: 0 0 12px rgba(212,160,23,0.15);
  }
  .zukan-card.unlocked:active { transform: scale(0.96); }
  .zukan-card-inner {
    padding: 16px 12px 12px;
    display: flex; flex-direction: column; align-items: center; gap: 8px;
  }
  .zukan-char-emoji-wrap {
    width: 72px; height: 72px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 40px;
    border: 2px solid rgba(255,255,255,0.1);
    position: relative;
  }
  .zukan-card.unlocked .zukan-char-emoji-wrap {
    border-color: var(--gold);
    box-shadow: 0 0 16px rgba(212,160,23,0.3);
  }
  /* æœªç²å¾—ã‚·ãƒ«ã‚¨ãƒƒãƒˆ */
  .zukan-card.locked .zukan-char-emoji-wrap {
    filter: brightness(0) contrast(0.2);
    border-color: rgba(255,255,255,0.05);
  }
  .zukan-card-name {
    font-family: "Zen Antique Soft", serif;
    font-size: 13px; color: var(--paper); text-align: center;
  }
  .zukan-card.locked .zukan-card-name { color: rgba(245,240,232,0.2); }
  .zukan-card-era {
    font-size: 9px; letter-spacing: 0.15em;
    color: rgba(245,240,232,0.4);
    padding: 2px 8px; border-radius: 99px;
    border: 1px solid rgba(255,255,255,0.1);
  }
  .zukan-card.unlocked .zukan-card-era {
    color: var(--gold); border-color: rgba(212,160,23,0.3);
  }


  /* é‡è¤‡æšæ•°ãƒãƒƒã‚¸ */
  .zukan-dupe-badge {
    position: absolute; bottom: 8px; right: 8px;
    font-size: 11px; font-weight: 900;
    color: var(--gold); background: rgba(212,160,23,0.15);
    border: 1px solid rgba(212,160,23,0.3);
    padding: 1px 6px; border-radius: 4px;
  }
  /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒãƒƒã‚¸ */
  .zukan-rarity-badge {
    position: absolute; top: 8px; right: 8px;
    font-size: 10px; font-weight: 900; letter-spacing: 0.05em;
    padding: 2px 7px; border-radius: 4px;
  }
  .zukan-card.locked .zukan-rarity-badge { display: none; }
  /* éµã‚¢ã‚¤ã‚³ãƒ³ */
  .zukan-lock-icon {
    position: absolute; top: 8px; right: 8px;
    font-size: 14px; opacity: 0.3;
  }
  .zukan-card.unlocked .zukan-lock-icon { display: none; }
  /* NEW ãƒãƒƒã‚¸ */
  .zukan-new-badge {
    position: absolute; top: 8px; left: 8px;
    background: var(--red); color: white;
    font-size: 9px; font-weight: 900; padding: 2px 6px;
    border-radius: 4px; letter-spacing: 0.05em;
    display: none;
  }
  .zukan-card.is-new .zukan-new-badge { display: block; }

  /* ã‚­ãƒ£ãƒ©è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .zukan-modal-overlay {
    position: fixed; inset: 0; z-index: 100;
    background: rgba(0,0,0,0.85);
    display: flex; align-items: center; justify-content: center;
    padding: 24px;
    opacity: 0; pointer-events: none;
    transition: opacity 0.25s;
  }
  .zukan-modal-overlay.open { opacity: 1; pointer-events: all; }
  .zukan-modal {
    background: linear-gradient(160deg, #0f0f22, #1a0a28);
    border: 1.5px solid rgba(212,160,23,0.4);
    border-radius: 16px;
    width: 100%; max-width: 340px;
    padding: 28px 24px;
    text-align: center;
    box-shadow: 0 0 40px rgba(212,160,23,0.2);
    transform: scale(0.9);
    transition: transform 0.25s ease;
  }
  .zukan-modal-overlay.open .zukan-modal { transform: scale(1); }
  .zukan-modal-emoji { font-size: 72px; margin-bottom: 12px; display: block; }
  .zukan-modal-name {
    font-family: "Zen Antique Soft", serif;
    font-size: 26px; color: var(--gold); margin-bottom: 4px;
  }
  .zukan-modal-era {
    font-size: 11px; color: rgba(245,240,232,0.5);
    letter-spacing: 0.2em; margin-bottom: 16px;
  }
  .zukan-modal-desc {
    font-size: 13px; color: rgba(245,240,232,0.75);
    line-height: 1.7; margin-bottom: 20px; text-align: left;
  }
  .zukan-modal-skill {
    background: rgba(212,160,23,0.08);
    border: 1px solid rgba(212,160,23,0.2);
    border-radius: 8px; padding: 10px 14px;
    margin-bottom: 20px; text-align: left;
  }
  .zukan-modal-skill-label { font-size: 9px; color: var(--gold); letter-spacing: 0.2em; margin-bottom: 4px; }
  .zukan-modal-skill-text { font-size: 13px; color: var(--paper); }
  .zukan-modal-close {
    background: none; border: 1px solid rgba(245,240,232,0.2);
    color: rgba(245,240,232,0.5); border-radius: 6px;
    padding: 10px 24px; font-family: "Noto Sans JP", sans-serif;
    font-size: 13px; cursor: pointer;
    transition: all 0.2s;
  }
  .zukan-modal-close:hover { border-color: rgba(245,240,232,0.5); color: var(--paper); }

  /* ç²å¾—æ¼”å‡º */
  @keyframes zukanUnlock {
    0%   { transform: scale(0.5) rotate(-10deg); opacity: 0; }
    60%  { transform: scale(1.15) rotate(3deg); opacity: 1; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }
  .zukan-card.just-unlocked .zukan-char-emoji-wrap {
    animation: zukanUnlock 0.5s ease forwards;
  }
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="screen-title" class="screen active">
  <div class="title-bg-lines"></div>
  <div class="title-seal"><span class="title-seal-kanji">å²</span></div>
  <div class="title-eyebrow">NIHON-SHI QUIZ BATTLE</div>
  <div class="title-main">æ­´å²ãƒãƒˆãƒ«ï¼<br>ãƒ‹ãƒƒãƒãƒ³å²</div>
  <div class="title-sub">ç¸„æ–‡ã‹ã‚‰è¿‘ç¾ä»£ã¾ã§ å…¨æ™‚ä»£ã«æŒ‘ã‚</div>

  <div class="title-chars">
    <div class="speed-lines"></div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">ğŸº</div>
        <div class="char-name-tag">å‘å¼¥å‘¼</div>
        <div class="char-era-badge">å¼¥ç”Ÿ</div>
      </div>
    </div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">âš”ï¸</div>
        <div class="char-name-tag">ç¹”ç”°ä¿¡é•·</div>
        <div class="char-era-badge">æˆ¦å›½</div>
      </div>
    </div>
    <div class="char-card">
      <div class="char-avatar">
        <div class="char-emoji">ğŸŒŠ</div>
        <div class="char-name-tag">å‚æœ¬é¾é¦¬</div>
        <div class="char-era-badge">å¹•æœ«</div>
      </div>
    </div>
  </div>

  <button class="zukan-btn" onclick="showZukan()">ğŸ“– ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å›³é‘‘</button>
  <button class="start-btn" onclick="showEraSelect()">ã¯ã€€ã˜ã€€ã‚ã€€ã‚‹</button>
  <div class="version-tag">PROTOTYPE v0.1 â€” å±±å·æº–æ‹ </div>
  <button class="admin-entry-btn" onclick="showPassword()">âš™ ç®¡ç†</button>
</div>

<!-- ERA SELECT SCREEN -->
<div id="screen-era" class="screen">
  <div class="era-header">
    <div class="era-header-top">
      <button class="back-btn" onclick="showTitle()">â† ã‚‚ã©ã‚‹</button>
      <h2>â›© æ™‚ä»£ã‚’é¸ã¹</h2>
    </div>
    <p>CHOOSE YOUR ERA â€” å…¨8æ™‚ä»£</p>
  </div>

  <div class="era-timeline" id="eraTimeline"></div>
</div>

<!-- QUIZ SCREEN -->
<div id="screen-quiz" class="screen">
  <div class="quiz-topbar">
    <div class="quiz-era-label" id="quizEraLabel">æˆ¦å›½æ™‚ä»£</div>
    <div class="quiz-score-display">Score <span id="scoreDisplay">0</span></div>
  </div>
  <div class="timer-bar-wrap">
    <div class="timer-bar-bg">
      <div class="timer-bar-fill" id="timerBar" style="width:100%"></div>
    </div>
    <div class="timer-text" id="timerText">20ç§’</div>
  </div>
  <div class="quiz-char-area">
    <div class="quiz-char-figure">
      <div class="quiz-char-emoji" id="quizCharEmoji">âš”ï¸</div>
      <div class="quiz-char-name" id="quizCharName">ç¹”ç”°ä¿¡é•·</div>
    </div>
    <div class="speech-bubble">
      <div class="q-number" id="qNumber">å•1 / 5</div>
      <div class="q-text" id="qText">å•é¡Œæ–‡ãŒã“ã“ã«å…¥ã‚Šã¾ã™</div>
    </div>
  </div>
  <div class="choices-area" id="choicesArea"></div>
</div>

<!-- RESULT SCREEN -->
<div id="screen-result" class="screen">
  <div class="result-burst"></div>
  <div class="result-rank" id="resultRank">â­</div>
  <div class="result-title-label">ç§°ã€€å·</div>
  <div class="result-title-text" id="resultTitle">å¤©ä¸‹çµ±ä¸€ã¸ã®é“</div>
  <div class="result-score-box">
    <div class="result-score-num" id="resultScore">0</div>
    <div class="result-score-label">SCORE</div>
    <div class="result-correct-count" id="resultCorrect">5å•ä¸­ 0å•æ­£è§£</div>
  </div>
  <div class="result-char-unlocked" id="result-char-area">
    <div class="result-char-unlocked-emoji" id="unlockedEmoji">âš”ï¸</div>
    <div class="result-char-unlocked-text">
      <div class="result-char-unlocked-label" id="result-char-unlocked-label">ğŸ”“ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è§£æ”¾ï¼</div>
      <div class="result-char-unlocked-name" id="unlockedName">ç¹”ç”°ä¿¡é•·</div>
    </div>
  </div>
  <div class="result-btns">
    <button class="result-btn-primary" onclick="replayQuiz()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼</button>
    <button class="result-btn-secondary" onclick="showEraSelect()">æ™‚ä»£é¸æŠã¸ã‚‚ã©ã‚‹</button>
  </div>
</div>



<!-- ZUKAN SCREEN -->
<div id="screen-zukan" class="screen">
  <div class="zukan-header">
    <div class="zukan-header-top">
      <button class="back-btn" onclick="showTitle()">â† ã‚‚ã©ã‚‹</button>
      <h2>ğŸ“– å›³é‘‘</h2>
    </div>
    <div class="zukan-header-sub">CHARACTER COLLECTION â€” ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é›†ã‚ã‚ˆã†</div>
    <div class="zukan-progress-bar-wrap">
      <div class="zukan-progress-bar-fill" id="zukanProgressFill" style="width:0%"></div>
    </div>
    <div class="zukan-progress-label" id="zukanProgressLabel">0 / 8 è§£æ”¾æ¸ˆã¿</div>
  </div>
  <div id="zukanContent"></div>
</div>

<!-- ZUKAN MODAL -->
<div class="zukan-modal-overlay" id="zukanModalOverlay" onclick="closeZukanModal(event)">
  <div class="zukan-modal" id="zukanModal">
    <span class="zukan-modal-emoji" id="modalEmoji">âš”ï¸</span>
    <div class="zukan-modal-name" id="modalName">ç¹”ç”°ä¿¡é•·</div>
    <div class="zukan-modal-era" id="modalEra">æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±æ™‚ä»£</div>
    <div class="zukan-modal-desc" id="modalDesc"></div>
    <div class="zukan-modal-skill">
      <div class="zukan-modal-skill-label">âœ¨ å¿…æ®ºæŠ€</div>
      <div class="zukan-modal-skill-text" id="modalSkill"></div>
    </div>
    <button class="zukan-modal-close" onclick="closeZukanModal()">ã¨ã˜ã‚‹</button>
  </div>
</div>

<!-- PASSWORD SCREEN -->
<div id="screen-password" class="screen">
  <div class="pw-icon">ğŸ”</div>
  <div class="pw-title">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</div>
  <div class="pw-sub">ADMIN ACCESS â€” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›</div>
  <div class="pw-input-wrap">
    <input class="pw-input" id="pwInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
      onkeydown="if(event.key==='Enter')checkPassword()">
    <button class="pw-toggle" onclick="togglePwVisibility()" id="pwToggle">ğŸ‘</button>
  </div>
  <div class="pw-error-msg" id="pwError"></div>
  <button class="pw-submit-btn" onclick="checkPassword()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  <button class="pw-back-btn" onclick="showTitle()">â† ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ã©ã‚‹</button>
</div>

<!-- ADMIN SCREEN -->
<div id="screen-admin" class="screen">
  <div class="admin-header">
    <div class="admin-header-top">
      <button class="back-btn" onclick="showTitle()">â† ã‚‚ã©ã‚‹</button>
      <h2>âš™ å•é¡Œç®¡ç†</h2>
    </div>
    <div class="admin-header-sub">QUESTION MANAGER â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ å•é¡Œ</div>
  </div>

  <div class="admin-stats">
    <div class="admin-stat-card">
      <div class="admin-stat-num" id="statBuiltin">40</div>
      <div class="admin-stat-label">ãƒ—ãƒªã‚»ãƒƒãƒˆå•é¡Œ</div>
    </div>
    <div class="admin-stat-card">
      <div class="admin-stat-num" id="statCustom">0</div>
      <div class="admin-stat-label">è¿½åŠ ã—ãŸå•é¡Œ</div>
    </div>
    <div class="admin-stat-card">
      <div class="admin-stat-num" id="statTotal">40</div>
      <div class="admin-stat-label">åˆè¨ˆ</div>
    </div>
  </div>

  <div class="admin-section" style="margin-top:16px">
    <div class="admin-section-title">ğŸ”„ NotionåŒæœŸ</div>
    <div class="admin-form">
      <div class="form-group">
        <label class="form-label">Notion APIã‚­ãƒ¼ï¼ˆIntegration Tokenï¼‰</label>
        <input class="form-input" id="notionApiKeyInput" type="password"
          placeholder="secret_xxxxxxxxxxxx"
          value="">
        <div class="form-hint">è¨­å®šã™ã‚‹ã¨Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å•é¡Œã‚’è‡ªå‹•å–å¾—ã—ã¾ã™</div>
      </div>
      <button class="admin-submit-btn" style="background:var(--blue);box-shadow:0 4px 0 #0a2a5a"
        onclick="syncFromNotion()">Notionã‹ã‚‰å•é¡Œã‚’åŒæœŸã™ã‚‹</button>
      <div id="notionSyncStatus" style="font-size:11px;color:rgba(245,240,232,0.5);min-height:18px;text-align:center;margin-top:4px"></div>
    </div>
  </div>

  <div class="admin-section">
    <div class="admin-section-title">â• æ–°ã—ã„å•é¡Œã‚’è¿½åŠ </div>
    <div class="admin-form">
      <div class="form-group">
        <label class="form-label">å•é¡Œæ–‡</label>
        <textarea class="form-textarea" id="formQuestion" placeholder="ä¾‹ï¼šå¤§åŒ–ã®æ”¹æ–°ãŒè¡Œã‚ã‚ŒãŸã®ã¯ä½•å¹´ï¼Ÿ"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">æ™‚ä»£</label>
          <select class="form-select" id="formEra">
            <option value="jomon">ç¸„æ–‡ãƒ»å¼¥ç”Ÿ</option>
            <option value="asuka">å¤å¢³ãƒ»é£›é³¥</option>
            <option value="nara">å¥ˆè‰¯ãƒ»å¹³å®‰</option>
            <option value="kamakura">éŒå€‰ãƒ»å®¤ç”º</option>
            <option value="sengoku" selected>æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±</option>
            <option value="edo">æ±Ÿæˆ¸</option>
            <option value="meiji">æ˜æ²»ãƒ»å¤§æ­£</option>
            <option value="showa">æ˜­å’Œãƒ»è¿‘ç¾ä»£</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">é›£æ˜“åº¦</label>
          <select class="form-select" id="formDifficulty">
            <option value="easy">â˜… ã‚„ã•ã—ã„</option>
            <option value="normal" selected>â˜…â˜… ãµã¤ã†</option>
            <option value="hard">â˜…â˜…â˜… ã‚€ãšã‹ã—ã„</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">é¸æŠè‚¢ï¼ˆæ­£è§£ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ç·‘ã«ã™ã‚‹ï¼‰</label>
        <div class="choices-grid">
          <div class="choice-input-wrap">
            <span class="choice-input-label">ï¼¡</span>
            <input class="choice-input" id="choiceA" type="text" placeholder="é¸æŠè‚¢A"
              onclick="setAnswer(0)">
          </div>
          <div class="choice-input-wrap">
            <span class="choice-input-label">ï¼¢</span>
            <input class="choice-input" id="choiceB" type="text" placeholder="é¸æŠè‚¢B"
              onclick="setAnswer(1)">
          </div>
          <div class="choice-input-wrap">
            <span class="choice-input-label">ï¼£</span>
            <input class="choice-input" id="choiceC" type="text" placeholder="é¸æŠè‚¢C"
              onclick="setAnswer(2)">
          </div>
          <div class="choice-input-wrap">
            <span class="choice-input-label">ï¼¤</span>
            <input class="choice-input" id="choiceD" type="text" placeholder="é¸æŠè‚¢D"
              onclick="setAnswer(3)">
          </div>
        </div>
        <div class="form-hint">â€» æ­£è§£ã«ã—ãŸã„é¸æŠè‚¢ã‚’ã‚¿ãƒƒãƒ— â†’ ç·‘ã«ãªã‚Šã¾ã™</div>
      </div>

      <div class="form-group">
        <label class="form-label">ãƒ’ãƒ³ãƒˆæ–‡ï¼ˆçœç•¥å¯ï¼‰</label>
        <input class="form-input" id="formHint" type="text" placeholder="ä¾‹ï¼šã“ã®å¹´ã‹ã‚‰å¹´å·ãŒå¤‰ã‚ã£ãŸã‚ˆï¼">
      </div>

      <button class="admin-submit-btn" onclick="addCustomQuestion()">å•é¡Œã‚’è¿½åŠ ã™ã‚‹</button>
    </div>
  </div>

  <div class="admin-section" style="margin-top:24px">
    <div class="admin-section-title">ğŸ“‹ è¿½åŠ æ¸ˆã¿ã®å•é¡Œ</div>
  </div>
  <div class="admin-q-list" id="adminQList"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- COMBO FLASH -->
<div class="combo-flash" id="comboFlash"></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ERAS = [
  {
    id:'jomon', name:'ç¸„æ–‡ãƒ»å¼¥ç”Ÿ', period:'ã€œ3ä¸–ç´€',
    emoji:'ğŸº', color:'#8B6914', glow:'rgba(139,105,20,0.4)',
    char:'å‘å¼¥å‘¼', charEmoji:'ğŸº',
    questions:[
      { q:'ç¸„æ–‡æ™‚ä»£ã‚’ä»£è¡¨ã™ã‚‹åœŸå™¨ã®ç‰¹å¾´ã¯ï¼Ÿ', choices:['ç¸„ç›®ã®æ–‡æ§˜ãŒã‚ã‚‹','è¡¨é¢ãŒãªã‚ã‚‰ã‹','é‡‘å±ãŒæ··ã˜ã£ã¦ã„ã‚‹','å½©è‰²ãŒæ–½ã•ã‚Œã¦ã„ã‚‹'], ans:0,
        hint:'ç¸„ã‚’è»¢ãŒã—ã¦æ¨¡æ§˜ã‚’ã¤ã‘ãŸã®ãŒåå‰ã®ç”±æ¥ã ã‚ˆï¼' },
      { q:'å¼¥ç”Ÿæ™‚ä»£ã«å¤§é™¸ã‹ã‚‰ä¼ã‚ã£ãŸè¾²æ¥­ã®ä¸­å¿ƒã¯ä½•ï¼Ÿ', choices:['éº¦ä½œ','ç¨²ä½œ','èŠ‹ä½œ','è±†ä½œ'], ans:1,
        hint:'ç¾ä»£ã®æ—¥æœ¬äººã®ä¸»é£Ÿã«ã‚‚ãªã£ã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'é‚ªé¦¬å°å›½ã®å¥³ç‹ã¨ã—ã¦é­å¿—å€­äººä¼ã«è¨˜ã•ã‚ŒãŸäººç‰©ã¯ï¼Ÿ', choices:['ç¥åŠŸçš‡å','å‘å¼¥å‘¼','æ¨å¤å¤©çš‡','æŒçµ±å¤©çš‡'], ans:1,
        hint:'å‘ªè¡“çš„ãªåŠ›ã§å›½ã‚’æ²»ã‚ãŸã¨ã•ã‚Œã‚‹è¬å¤šãå¥³ç‹ã ï¼' },
      { q:'ç¸„æ–‡æ™‚ä»£ã®äººã€…ãŒé£Ÿã¹ãŸã‚‚ã®ã‚’æ¨ã¦ãŸå ´æ‰€ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['åœŸå¡','å €','è²å¡š','ç’°æ¿ '], ans:2,
        hint:'è²ã®æ®»ãªã©ãŒç©ã¿é‡ãªã£ãŸå ´æ‰€ã®ã“ã¨ã ã‚ˆï¼' },
      { q:'å¼¥ç”Ÿæ™‚ä»£ã®é›†è½ã‚’å®ˆã‚‹ãŸã‚ã«æ˜ã‚‰ã‚ŒãŸå €ã®ã‚ã‚‹æ‘ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['å±±åŸ','ç’°æ¿ é›†è½','è˜åœ’','æ¡é‡Œ'], ans:1,
        hint:'ã¾ã‚ã‚Šã‚’ãã‚‹ã£ã¨å €ã§å›²ã‚“ã é›†è½ã ã‚ˆï¼' },
    ]
  },
  {
    id:'asuka', name:'å¤å¢³ãƒ»é£›é³¥', period:'3ã€œ7ä¸–ç´€',
    emoji:'ğŸ—¿', color:'#5a4f9a', glow:'rgba(90,79,154,0.4)',
    char:'è–å¾³å¤ªå­', charEmoji:'ğŸ“œ',
    questions:[
      { q:'ã€Œå’Œã‚’ä»¥ã¦è²´ã—ã¨ãªã™ã€ã§å§‹ã¾ã‚‹æ†²æ³•ã‚’åˆ¶å®šã—ãŸã®ã¯ï¼Ÿ', choices:['å¤©æ­¦å¤©çš‡','è–å¾³å¤ªå­','è—¤åŸéŒè¶³','ä¸­å¤§å…„çš‡å­'], ans:1,
        hint:'ä¸€åº¦ã«10äººã®è©±ã‚’èã‘ãŸã¨ã„ã†ä¼èª¬ã®äººç‰©ã ï¼' },
      { q:'645å¹´ã«è¡Œã‚ã‚ŒãŸæ”¿æ²»æ”¹é©ã®åç§°ã¯ï¼Ÿ', choices:['æ‰¿ä¹…ã®ä¹±','å¤§åŒ–ã®æ”¹æ–°','å£¬ç”³ã®ä¹±','å¿œä»ã®ä¹±'], ans:1,
        hint:'å¹´å·ãŒã€Œå¤§åŒ–ã€ã«æ”¹ã‚ã‚‰ã‚ŒãŸæ”¹é©ã ã‚ˆï¼' },
      { q:'å¤§å’Œæ”¿æ¨©ã®ç‹ã‚’ä½•ã¨å‘¼ã‚“ã ã‹ï¼Ÿ', choices:['å°†è»','å¤©çš‡','å¤§ç‹(ãŠãŠãã¿)','å¹•åºœ'], ans:2,
        hint:'å½“æ™‚ã¯ã¾ã ã€Œå¤©çš‡ã€ã¨ã„ã†è¨€è‘‰ã¯ä½¿ã‚ã‚Œã¦ã„ãªã‹ã£ãŸã‚ˆï¼' },
      { q:'å¤å¢³ã®å½¢ã¨ã—ã¦æœ€ã‚‚å¤§ããªå‰æ–¹å¾Œå††å¢³ãŒã‚ã‚‹å ´æ‰€ã¯ï¼Ÿ', choices:['å¥ˆè‰¯','å¤§é˜ª','äº¬éƒ½','ç¦å²¡'], ans:1,
        hint:'ä»å¾³å¤©çš‡é™µã¯ä¸–ç•Œæœ€å¤§è¦æ¨¡ã®å¢³å¢“ã ã‚ˆï¼' },
      { q:'è–å¾³å¤ªå­ãŒå»ºç«‹ã—ãŸã¨ã•ã‚Œã‚‹å¯ºé™¢ã¯ï¼Ÿ', choices:['æ±å¤§å¯º','æ³•éš†å¯º','å”æ‹›æå¯º','å»¶æš¦å¯º'], ans:1,
        hint:'ç¾å­˜ã™ã‚‹ä¸–ç•Œæœ€å¤ã®æœ¨é€ å»ºç¯‰ç¾¤ã ã‚ˆï¼' },
    ]
  },
  {
    id:'nara', name:'å¥ˆè‰¯ãƒ»å¹³å®‰', period:'8ã€œ12ä¸–ç´€',
    emoji:'ğŸ¦Œ', color:'#3a7a3a', glow:'rgba(58,122,58,0.4)',
    char:'è—¤åŸé“é•·', charEmoji:'ğŸŒ•',
    questions:[
      { q:'ã€Œã“ã®ä¸–ã‚’ã°æˆ‘ãŒä¸–ã¨ãæ€ãµã€ã¨è© ã‚“ã äººç‰©ã¯ï¼Ÿ', choices:['ç´«å¼éƒ¨','è—¤åŸé“é•·','åœ¨åŸæ¥­å¹³','è…åŸé“çœŸ'], ans:1,
        hint:'å¨˜3äººãŒå¤©çš‡ã®å¦ƒã«ãªã£ãŸçµ¶é ‚æœŸã®æ­Œã ã‚ˆï¼' },
      { q:'å¥ˆè‰¯æ™‚ä»£ã«å…¨å›½ã«ç½®ã‹ã‚ŒãŸå›½ã”ã¨ã®å¯ºã®åç§°ã¯ï¼Ÿ', choices:['å»¶æš¦å¯º','å›½åˆ†å¯º','æ³•éš†å¯º','èˆˆç¦å¯º'], ans:1,
        hint:'å›½ã‚’å®ˆã‚‹ãŸã‚ã«å…¨å›½ã«å»ºã¦ã‚‰ã‚ŒãŸå¯ºã ã‚ˆï¼' },
      { q:'æºæ°ç‰©èªã‚’æ›¸ã„ãŸä½œå®¶ã¯ï¼Ÿ', choices:['æ¸…å°‘ç´è¨€','ç´«å¼éƒ¨','å’Œæ³‰å¼éƒ¨','å°é‡å°ç”º'], ans:1,
        hint:'ä¸–ç•Œæœ€å¤ã®é•·ç·¨å°èª¬ã¨ã‚‚ã„ã‚ã‚Œã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'å¹³å®‰æ™‚ä»£ã«å‹¢åŠ›ã‚’èª‡ã£ãŸæ°æ—ã¯ï¼Ÿ', choices:['æºæ°','å¹³æ°','è—¤åŸæ°','æ©˜æ°'], ans:2,
        hint:'æ‘‚é–¢æ”¿æ²»ã§å¤©çš‡å®¶ã¨ã®å©šå§»é–¢ä¿‚ã‚’åˆ©ç”¨ã—ãŸæ°æ—ã ã‚ˆï¼' },
      { q:'å¥ˆè‰¯ã®å¤§ä»ï¼ˆæ±å¤§å¯ºç›§èˆé‚£ä»ï¼‰ã‚’å»ºç«‹ã—ãŸå¤©çš‡ã¯ï¼Ÿ', choices:['è–æ­¦å¤©çš‡','æ¡“æ­¦å¤©çš‡','åµ¯å³¨å¤©çš‡','é†é†å¤©çš‡'], ans:0,
        hint:'ä»ã®åŠ›ã§å›½ã‚’æ²»ã‚ã‚ˆã†ã¨ã—ãŸå¤©çš‡ã ã‚ˆï¼' },
    ]
  },
  {
    id:'kamakura', name:'éŒå€‰ãƒ»å®¤ç”º', period:'12ã€œ15ä¸–ç´€',
    emoji:'â›©', color:'#7a2020', glow:'rgba(122,32,32,0.5)',
    char:'æºé ¼æœ', charEmoji:'ğŸ¯',
    questions:[
      { q:'éŒå€‰å¹•åºœã‚’é–‹ã„ãŸäººç‰©ã¯ï¼Ÿ', choices:['æºç¾©çµŒ','æºé ¼æœ','åŒ—æ¡æ™‚å®—','è¶³åˆ©å°Šæ°'], ans:1,
        hint:'å¼Ÿãƒ»ç¾©çµŒã¨ã®ç¢ºåŸ·ã§ã‚‚æœ‰åãªæ­¦å°†ã ã‚ˆï¼' },
      { q:'å…ƒã®å¤§è»ãŒ2åº¦ã«ã‚ãŸã£ã¦æ—¥æœ¬ã«æ”»ã‚ã¦ããŸå‡ºæ¥äº‹ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['å£¬ç”³ã®ä¹±','å…ƒå¯‡','ä¿å…ƒã®ä¹±','å¿œä»ã®ä¹±'], ans:1,
        hint:'æš´é¢¨é›¨ï¼ˆç¥é¢¨ï¼‰ãŒæ—¥æœ¬ã‚’æ•‘ã£ãŸã¨ã‚‚è¨€ã‚ã‚Œã¦ã„ã‚‹ã‚ˆï¼' },
      { q:'å®¤ç”ºå¹•åºœã‚’é–‹ã„ãŸäººç‰©ã¯ï¼Ÿ', choices:['è¶³åˆ©ç¾©æº€','è¶³åˆ©å°Šæ°','è¶³åˆ©ç¾©æ”¿','è¶³åˆ©ç¾©æ˜­'], ans:1,
        hint:'å—åŒ—æœã®å¯¾ç«‹ã‚’çµ‚ã‚ã‚‰ã›ãŸäººç‰©ã ã‚ˆï¼' },
      { q:'1467å¹´ã«å§‹ã¾ã£ãŸç´„11å¹´é–“ç¶šãå¤§ä¹±ã®åå‰ã¯ï¼Ÿ', choices:['æ‰¿ä¹…ã®ä¹±','é–¢ãƒ¶åŸã®æˆ¦ã„','å¿œä»ã®ä¹±','æ¡¶ç‹­é–“ã®æˆ¦ã„'], ans:2,
        hint:'ã“ã®ä¹±ã§äº¬éƒ½ã¯ç„¼ã‘é‡åŸã«ãªã‚Šæˆ¦å›½æ™‚ä»£ã«çªå…¥ã—ãŸã‚ˆï¼' },
      { q:'éŒå€‰æ™‚ä»£ã«æ­¦å£«ãŒå®ˆã‚‹ã¹ãé“å¾³ã€Œå¾¡æˆæ•—å¼ç›®ã€ã‚’åˆ¶å®šã—ãŸã®ã¯ï¼Ÿ', choices:['åŒ—æ¡æ³°æ™‚','æºé ¼æœ','å¾Œé³¥ç¾½ä¸Šçš‡','åŒ—æ¡æ™‚å®—'], ans:0,
        hint:'æ­¦å£«ã®ãŸã‚ã®æœ€åˆã®æ³•å¾‹é›†ã ã‚ˆï¼' },
    ]
  },
  {
    id:'sengoku', name:'æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±', period:'15ã€œ16ä¸–ç´€',
    emoji:'âš”ï¸', color:'#cc2200', glow:'rgba(204,34,0,0.5)',
    char:'ç¹”ç”°ä¿¡é•·', charEmoji:'âš”ï¸',
    questions:[
      { q:'ã€Œæ¡¶ç‹­é–“ã®æˆ¦ã„ã€ã§ä»Šå·ç¾©å…ƒã‚’ç ´ã£ãŸæ­¦å°†ã¯ï¼Ÿ', choices:['è±Šè‡£ç§€å‰','å¾³å·å®¶åº·','æ­¦ç”°ä¿¡ç„','ç¹”ç”°ä¿¡é•·'], ans:3,
        hint:'å°‘ãªã„å…µåŠ›ã§å¤§è»ã«å¥‡è¥²ã‚’ã‹ã‘ãŸå¥‡è·¡ã®æˆ¦ã„ã ã‚ˆï¼' },
      { q:'ç¹”ç”°ä¿¡é•·ã®å¤©ä¸‹çµ±ä¸€ã‚’ç¶™ã„ã§å…¨å›½çµ±ä¸€ã‚’æœãŸã—ãŸäººç‰©ã¯ï¼Ÿ', choices:['å¾³å·å®¶åº·','è±Šè‡£ç§€å‰','æ˜æ™ºå…‰ç§€','æŸ´ç”°å‹å®¶'], ans:1,
        hint:'è¾²æ°‘å‡ºèº«ã§å¤©ä¸‹äººã«ãªã£ãŸç«‹å¿—ä¼ä¸­ã®äººç‰©ã ã‚ˆï¼' },
      { q:'æœ¬èƒ½å¯ºã®å¤‰ã§ç¹”ç”°ä¿¡é•·ã‚’è¥²ã£ãŸäººç‰©ã¯ï¼Ÿ', choices:['è±Šè‡£ç§€å‰','å¾³å·å®¶åº·','æ˜æ™ºå…‰ç§€','ä¸Šæ‰è¬™ä¿¡'], ans:2,
        hint:'ã€Œæ•µã¯æœ¬èƒ½å¯ºã«ã‚ã‚Šï¼ã€ã¨ã„ã†è¨€è‘‰ã§æœ‰åã ã‚ˆï¼' },
      { q:'è±Šè‡£ç§€å‰ãŒè¡Œã£ãŸè¾²æ°‘ã‹ã‚‰æ­¦å™¨ã‚’æ²¡åã—ãŸæ”¿ç­–ã¯ï¼Ÿ', choices:['å‚å‹¤äº¤ä»£','åˆ€ç‹©','å¤ªé–¤æ¤œåœ°','æ¥½å¸‚æ¥½åº§'], ans:1,
        hint:'è¾²æ°‘ã¨æ­¦å£«ã®èº«åˆ†ã‚’ã¯ã£ãã‚Šåˆ†ã‘ãŸæ”¿ç­–ã ã‚ˆï¼' },
      { q:'ç¹”ç”°ä¿¡é•·ãŒé‡è¦–ã—ãŸçµŒæ¸ˆæ”¿ç­–ã§ã€å¸‚å ´ã§ã®è‡ªç”±ãªå–å¼•ã‚’èªã‚ãŸã®ã¯ï¼Ÿ', choices:['å¤ªé–¤æ¤œåœ°','åˆ€ç‹©','æ¥½å¸‚æ¥½åº§','å‚å‹¤äº¤ä»£'], ans:2,
        hint:'å¸‚å ´ã®ç‹¬å ã‚’ãªãã—ã¦å•†æ¥­ã‚’æ´»ç™ºã«ã—ãŸæ”¿ç­–ã ã‚ˆï¼' },
    ]
  },
  {
    id:'edo', name:'æ±Ÿæˆ¸', period:'17ã€œ19ä¸–ç´€',
    emoji:'ğŸ—»', color:'#1a5a8a', glow:'rgba(26,90,138,0.5)',
    char:'å¾³å·å®¶åº·', charEmoji:'ğŸ—»',
    questions:[
      { q:'æ±Ÿæˆ¸å¹•åºœãŒé–å›½ä¸­ã«è²¿æ˜“ã‚’è¨±å¯ã—ã¦ã„ãŸå›½ã¯ï¼Ÿ', choices:['ã‚¹ãƒšã‚¤ãƒ³','ãƒãƒ«ãƒˆã‚¬ãƒ«','ã‚ªãƒ©ãƒ³ãƒ€','ã‚¤ã‚®ãƒªã‚¹'], ans:2,
        hint:'å‡ºå³¶ã¨ã„ã†äººå·¥å³¶ã§ã®ã¿è²¿æ˜“ãŒè¨±ã•ã‚Œã¦ã„ãŸã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸æ™‚ä»£ã«å‚å‹¤äº¤ä»£åˆ¶åº¦ã‚’æ•´å‚™ã—ãŸå°†è»ã¯ï¼Ÿ', choices:['å¾³å·å®¶åº·','å¾³å·å®¶å…‰','å¾³å·å‰å®—','å¾³å·æ…¶å–œ'], ans:1,
        hint:'3ä»£å°†è»ã§å¹•è—©ä½“åˆ¶ã‚’å›ºã‚ãŸäººç‰©ã ã‚ˆï¼' },
      { q:'1853å¹´ã«æ—¥æœ¬ã«é–‹å›½ã‚’æ±‚ã‚ã¦ã‚„ã£ã¦ããŸã‚¢ãƒ¡ãƒªã‚«ã®è»äººã¯ï¼Ÿ', choices:['ãƒãƒƒã‚«ãƒ¼ã‚µãƒ¼','ãƒšãƒªãƒ¼','ãƒãƒªã‚¹','ãƒ¯ã‚·ãƒ³ãƒˆãƒ³'], ans:1,
        hint:'ã€Œé»’èˆ¹æ¥èˆªã€ã§æœ‰åãªæç£ã ã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸æ™‚ä»£ã«åº¶æ°‘ã®å­ã©ã‚‚ãŸã¡ãŒé€šã£ãŸæ•™è‚²æ©Ÿé–¢ã¯ï¼Ÿ', choices:['å¤§å­¦','è—©æ ¡','å¯ºå­å±‹','å›½å­¦é™¢'], ans:2,
        hint:'èª­ã¿ãƒ»æ›¸ããƒ»ç®—ç›¤ã‚’æ•™ãˆãŸåº¶æ°‘ã®ãŸã‚ã®å­¦æ ¡ã ã‚ˆï¼' },
      { q:'æ±Ÿæˆ¸å¹•åºœæœ€å¾Œã®å°†è»ã¯èª°ï¼Ÿ', choices:['å¾³å·æ…¶å–œ','å¾³å·å®¶èŒ‚','å¾³å·æ–‰æ˜­','å¾³å·å‰å®—'], ans:0,
        hint:'å¤§æ”¿å¥‰é‚„ã‚’è¡Œã„æ±Ÿæˆ¸æ™‚ä»£ã«å¹•ã‚’å¼•ã„ãŸå°†è»ã ã‚ˆï¼' },
    ]
  },
  {
    id:'meiji', name:'æ˜æ²»ãƒ»å¤§æ­£', period:'1868ã€œ1926',
    emoji:'ğŸŒ…', color:'#9a4a00', glow:'rgba(154,74,0,0.5)',
    char:'å‚æœ¬é¾é¦¬', charEmoji:'ğŸŒŠ',
    questions:[
      { q:'æ˜æ²»æ”¿åºœãŒæ–‡æ˜é–‹åŒ–ã‚’é€²ã‚ã‚‹ä¸­ã§1872å¹´ã«ç™ºå¸ƒã—ãŸæ•™è‚²ã«é–¢ã™ã‚‹æ³•ä»¤ã¯ï¼Ÿ', choices:['æ†²æ³•','å­¦åˆ¶','æ°‘æ³•','å¾´å…µä»¤'], ans:1,
        hint:'ã™ã¹ã¦ã®å›½æ°‘ãŒæ•™è‚²ã‚’å—ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸæ³•ä»¤ã ã‚ˆï¼' },
      { q:'1905å¹´ã®æ—¥éœ²æˆ¦äº‰ã®è¬›å’Œæ¡ç´„ã®åå‰ã¯ï¼Ÿ', choices:['ä¸‹é–¢æ¡ç´„','æ—¥ç±³å’Œè¦ªæ¡ç´„','ãƒãƒ¼ãƒ„ãƒã‚¹æ¡ç´„','æ—¥éŸ“ä½µåˆæ¡ç´„'], ans:2,
        hint:'ã‚¢ãƒ¡ãƒªã‚«ã®ãƒ«ãƒ¼ã‚ºãƒ™ãƒ«ãƒˆå¤§çµ±é ˜ãŒä»²ä»‹ã—ãŸã‚ˆï¼' },
      { q:'æ˜æ²»æ™‚ä»£ã«ã€Œå¯Œå›½å¼·å…µã€ã®ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã®ã‚‚ã¨é€²ã‚ã‚‰ã‚ŒãŸç”£æ¥­åŒ–æ”¿ç­–ã¯ï¼Ÿ', choices:['å»ƒè—©ç½®çœŒ','æ–‡æ˜é–‹åŒ–','æ®–ç”£èˆˆæ¥­','åœ°ç§Ÿæ”¹æ­£'], ans:2,
        hint:'å®˜å–¶å·¥å ´ã‚’å»ºè¨­ã—ã¦ç”£æ¥­ã‚’è‚²ã¦ãŸæ”¿ç­–ã ã‚ˆï¼' },
      { q:'1889å¹´ã«ç™ºå¸ƒã•ã‚ŒãŸæ—¥æœ¬åˆã®è¿‘ä»£çš„æ†²æ³•ã®åç§°ã¯ï¼Ÿ', choices:['æ—¥æœ¬å›½æ†²æ³•','å¤§æ—¥æœ¬å¸å›½æ†²æ³•','æ˜æ²»æ†²æ³•','å¸å›½æ†²æ³•'], ans:1,
        hint:'ä¼Šè—¤åšæ–‡ãŒä¸­å¿ƒã«ãªã£ã¦ä½œã£ãŸæ¬½å®šæ†²æ³•ã ã‚ˆï¼' },
      { q:'æ—¥æ¸…æˆ¦äº‰ã®è¬›å’Œæ¡ç´„ãŒçµã°ã‚ŒãŸå ´æ‰€ã¯ï¼Ÿ', choices:['æ±äº¬','ä¸‹é–¢','é•·å´','æ¨ªæµœ'], ans:1,
        hint:'å±±å£çœŒã®æ¸¯ç”ºã§æ¡ç´„ãŒèª¿å°ã•ã‚ŒãŸã‚ˆï¼' },
    ]
  },
  {
    id:'showa', name:'æ˜­å’Œãƒ»è¿‘ç¾ä»£', period:'1926ã€œ',
    emoji:'ğŸ•Šï¸', color:'#3a6a3a', glow:'rgba(58,106,58,0.5)',
    char:'æ±éƒ·å¹³å…«éƒ', charEmoji:'ğŸ•Šï¸',
    questions:[
      { q:'1945å¹´8æœˆ15æ—¥ã®å¤©çš‡ã«ã‚ˆã‚‹æ”¾é€ã§æ—¥æœ¬ãŒçµ‚æˆ¦ã‚’å‘Šã’ãŸã“ã®æ”¾é€ã‚’ä½•ã¨ã„ã†ï¼Ÿ', choices:['ç‹¬ç«‹å®£è¨€','ç‰éŸ³æ”¾é€','é™ä¼å®£è¨€','çµ‚æˆ¦è¨˜å¿µæ—¥'], ans:1,
        hint:'æ˜­å’Œå¤©çš‡ã®å£°ã§æˆ¦äº‰çµ‚çµãŒå›½æ°‘ã«ä¼ãˆã‚‰ã‚ŒãŸã‚ˆï¼' },
      { q:'1964å¹´ã«æ±äº¬ã§é–‹å‚¬ã•ã‚ŒãŸä¸–ç•Œçš„ã‚¹ãƒãƒ¼ãƒ„å¤§ä¼šã¯ï¼Ÿ', choices:['ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚«ãƒƒãƒ—','ãƒ©ã‚°ãƒ“ãƒ¼Wæ¯','æ±äº¬ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯','ã‚¢ã‚¸ã‚¢å¤§ä¼š'], ans:2,
        hint:'é«˜åº¦çµŒæ¸ˆæˆé•·æœŸã®æ—¥æœ¬ã®å¾©èˆˆã‚’ä¸–ç•Œã«ç¤ºã—ãŸå¤§ä¼šã ã‚ˆï¼' },
      { q:'å¤ªå¹³æ´‹æˆ¦äº‰é–‹æˆ¦ã®ãã£ã‹ã‘ã¨ãªã£ãŸ1941å¹´ã®æ”»æ’ƒã®å ´æ‰€ã¯ï¼Ÿ', choices:['ã‚°ã‚¢ãƒ ','ãƒ•ã‚£ãƒªãƒ”ãƒ³','çœŸç æ¹¾','ãƒŸãƒƒãƒ‰ã‚¦ã‚§ãƒ¼'], ans:2,
        hint:'ãƒãƒ¯ã‚¤ã®ã‚¢ãƒ¡ãƒªã‚«æµ·è»åŸºåœ°ã¸ã®å¥‡è¥²æ”»æ’ƒã ã‚ˆï¼' },
      { q:'1951å¹´ã«çµã°ã‚ŒãŸæ—¥æœ¬ã®ä¸»æ¨©å›å¾©ã‚’å®šã‚ãŸæ¡ç´„ã¯ï¼Ÿ', choices:['æ—¥ç±³å®‰ä¿æ¡ç´„','ã‚µãƒ³ãƒ•ãƒ©ãƒ³ã‚·ã‚¹ã‚³å¹³å’Œæ¡ç´„','æ—¥ä¸­å¹³å’Œå‹å¥½æ¡ç´„','æ—¥ã‚½ä¸­ç«‹æ¡ç´„'], ans:1,
        hint:'GHQã«ã‚ˆã‚‹å é ˜ãŒçµ‚ã‚ã‚Šã‚’å‘Šã’ãŸæ¡ç´„ã ã‚ˆï¼' },
      { q:'æˆ¦å¾Œã®é«˜åº¦çµŒæ¸ˆæˆé•·æœŸã«æ—¥æœ¬ãŒé”æˆã—ãŸGNPä¸–ç•Œç¬¬2ä½ã«ãªã£ãŸã®ã¯ã„ã¤é ƒï¼Ÿ', choices:['1950å¹´ä»£','1960å¹´ä»£','1970å¹´ä»£','1980å¹´ä»£'], ans:1,
        hint:'æ–°å¹¹ç·šé–‹æ¥­ã‚„æ±äº¬äº”è¼ªã‚‚åŒã˜æ™‚ä»£ã ã‚ˆï¼' },
    ]
  },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentEra = null;
let currentQuestions = [];
let currentQIndex = 0;
let score = 0;
let correctCount = 0;
let combo = 0;
let timerInterval = null;
let timeLeft = 20;
let answered = false;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCREEN NAVIGATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function showTitle() { showScreen('screen-title'); }

function showEraSelect() {
  showScreen('screen-era');
  renderEraList();
}

function renderEraList() {
  const tl = document.getElementById('eraTimeline');
  tl.innerHTML = '';
  ERAS.forEach(era => {
    const item = document.createElement('div');
    item.className = 'era-item';
    item.innerHTML = `
      <div class="era-dot" style="border-color:${era.color};background:rgba(${hexToRgb(era.color)},0.15);box-shadow:0 0 12px ${era.glow}">
        <span>${era.emoji}</span>
      </div>
      <div class="era-card">
        <div class="era-card-name">${era.name}</div>
        <div class="era-card-period">${era.period}</div>
        <div class="era-card-count">${era.questions.length}å•</div>
        <div class="era-card-bar" style="background:${era.color};width:0"></div>
      </div>
    `;
    item.addEventListener('click', () => startQuiz(era));
    tl.appendChild(item);
  });
}

function hexToRgb(hex) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `${r},${g},${b}`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// QUIZ LOGIC
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startQuiz(era) {
  currentEra = era;
  currentQuestions = shuffle([...era.questions]).slice(0, 5);
  currentQIndex = 0;
  score = 0;
  correctCount = 0;
  combo = 0;

  document.getElementById('quizEraLabel').textContent = era.name;
  document.getElementById('quizCharEmoji').textContent = era.charEmoji;
  document.getElementById('quizCharName').textContent = era.char;

  showScreen('screen-quiz');
  renderQuestion();
}

function renderQuestion() {
  clearTimer();
  answered = false;

  const q = currentQuestions[currentQIndex];
  document.getElementById('qNumber').textContent = `å•${currentQIndex + 1} / ${currentQuestions.length}`;
  document.getElementById('qText').textContent = q.q;
  document.getElementById('scoreDisplay').textContent = score;

  const area = document.getElementById('choicesArea');
  area.innerHTML = '';
  const labels = ['ï¼¡','ï¼¢','ï¼£','ï¼¤'];
  q.choices.forEach((c, i) => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.innerHTML = `<span class="choice-label">${labels[i]}</span>${c}`;
    btn.addEventListener('click', () => selectAnswer(i, q.ans, q.hint));
    area.appendChild(btn);
  });

  startTimer();
}

function startTimer() {
  timeLeft = 20;
  updateTimerUI();
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerUI();
    if (timeLeft <= 0) {
      clearTimer();
      if (!answered) timeUp();
    }
  }, 1000);
}

function updateTimerUI() {
  const pct = (timeLeft / 20) * 100;
  const bar = document.getElementById('timerBar');
  bar.style.width = pct + '%';
  if (pct < 30) bar.style.background = 'var(--red)';
  else if (pct < 60) bar.style.background = 'linear-gradient(90deg,#ff8800,var(--accent))';
  else bar.style.background = 'linear-gradient(90deg,var(--gold),var(--accent))';
  document.getElementById('timerText').textContent = timeLeft + 'ç§’';
}

function clearTimer() {
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
}

function timeUp() {
  answered = true;
  combo = 0;
  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach((b, i) => {
    b.classList.add('disabled');
    if (i === currentQuestions[currentQIndex].ans) b.classList.add('correct');
  });
  setTimeout(nextQuestion, 1500);
}

function selectAnswer(selected, correct, hint) {
  if (answered) return;
  answered = true;
  clearTimer();

  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach(b => b.classList.add('disabled'));

  if (selected === correct) {
    btns[selected].classList.add('correct');
    correctCount++;
    combo++;
    const pts = 100 + (timeLeft * 5) + (combo > 1 ? combo * 20 : 0);
    score += pts;
    spawnParticles(btns[selected]);
    if (combo >= 2) showCombo(combo);
  } else {
    btns[selected].classList.add('wrong');
    btns[correct].classList.add('correct');
    combo = 0;
  }

  document.getElementById('scoreDisplay').textContent = score;
  setTimeout(nextQuestion, 1600);
}

function nextQuestion() {
  currentQIndex++;
  if (currentQIndex >= currentQuestions.length) {
    showResult();
  } else {
    renderQuestion();
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COMBO
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showCombo(n) {
  const el = document.getElementById('comboFlash');
  const texts = { 2:'COMBO!', 3:'GREAT!!', 4:'AMAZING!!!', 5:'PERFECT!!!!' };
  const colors = { 2:var_gold(), 3:'#ff8800', 4:'#ff4422', 5:'#ff00ff' };
  el.textContent = texts[n] || `${n}é€£ç¶šï¼`;
  el.style.color = colors[n] || '#ff00ff';
  el.classList.remove('show');
  void el.offsetWidth;
  el.classList.add('show');
}
function var_gold() { return '#ffcc00'; }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PARTICLES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function spawnParticles(el) {
  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  for (let i = 0; i < 12; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const angle = (i / 12) * 360;
    const dist = 60 + Math.random() * 60;
    const tx = Math.cos(angle * Math.PI/180) * dist;
    const ty = Math.sin(angle * Math.PI/180) * dist;
    p.style.cssText = `left:${cx}px;top:${cy}px;background:${['#ffcc00','#ff4422','#00c864'][i%3]};--tx:${tx}px;--ty:${ty}px;`;
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 1000);
  }
}


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ZUKANï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å›³é‘‘ï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ZUKAN_STORAGE_KEY = 'nihonshi_unlocked_chars_v2'; // v2: ã‚«ãƒ¼ãƒ‰IDã§ç®¡ç†
const ZUKAN_NEW_KEY     = 'nihonshi_new_chars_v2';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
// rarity: N=ãƒãƒ¼ãƒãƒ«(50%), R=ãƒ¬ã‚¢(35%), SR=è¶…ãƒ¬ã‚¢(15%)
// id: "eraId_ç•ªå·" ã§ä¸€æ„
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ALL_CHARS = [
  // ç¸„æ–‡ãƒ»å¼¥ç”Ÿ
  { id:'jomon_1', eraId:'jomon', rarity:'SR', emoji:'ğŸº', name:'å‘å¼¥å‘¼',     desc:'è¬å¤šãå¼¥ç”Ÿã®å¥³ç‹ã€‚é¬¼é“ï¼ˆå‘ªè¡“ï¼‰ã§å›½ã‚’çµ±ã¹ã€é­ã®çš‡å¸ã‹ã‚‰ã€Œè¦ªé­å€­ç‹ã€ã®ç§°å·ã‚’å¾—ãŸã€‚é‚ªé¦¬å°å›½ã®æ‰€åœ¨ã¯ã„ã¾ã è¬ã«åŒ…ã¾ã‚Œã¦ã„ã‚‹ã€‚', skill:'é¬¼é“ã®å°å° â€” æ•µå…¨å“¡ã®å‹•ãã‚’æ­¢ã‚ã‚‹ç¥ç§˜ã®çµç•Œï¼' },
  { id:'jomon_2', eraId:'jomon', rarity:'R',  emoji:'ğŸŒ¾', name:'å¼¥ç”Ÿäººã®è¾²å¤«', desc:'å¤§é™¸ã‹ã‚‰ç¨²ä½œã®æŠ€è¡“ã‚’æŒã¡è¾¼ã‚“ã å¼¥ç”Ÿã®è¾²å¤«ã€‚æ°´ç”°è¾²è€•ã‚’åºƒã‚ã€æ—¥æœ¬ã®é£Ÿæ–‡åŒ–ã®ç¤ã‚’ç¯‰ã„ãŸã€‚', skill:'è±Šç©£ã®æµã¿ â€” ä»²é–“å…¨å“¡ã®HPã‚’å›å¾©ï¼' },
  { id:'jomon_3', eraId:'jomon', rarity:'N',  emoji:'ğŸ¹', name:'ç¸„æ–‡ã®ç‹©äºº',   desc:'ç¸„æ–‡æ™‚ä»£ã‚’ç”ŸãæŠœã„ãŸå¼“ã®åæ‰‹ã€‚åœŸå¶ã‚’ä½œã‚Šã€è±Šç©£ã‚’ç¥ˆã£ãŸã€‚1ä¸‡å¹´ä»¥ä¸Šç¶šã„ãŸç¸„æ–‡æ–‡åŒ–ã®æ‹…ã„æ‰‹ã€‚', skill:'çŸ³éƒã®ä¸€çŸ¢ â€” å˜ä½“ã«ç¢ºå®Ÿãªãƒ€ãƒ¡ãƒ¼ã‚¸ï¼' },
  { id:'jomon_4', eraId:'jomon', rarity:'R',  emoji:'ğŸ—¡ï¸', name:'ã‚¹ã‚µãƒã‚ª',     desc:'ãƒ¤ãƒã‚¿ãƒã‚ªãƒ­ãƒã‚’é€€æ²»ã—ãŸåµã®ç¥ã€‚å§‰ãƒ»ã‚¢ãƒãƒ†ãƒ©ã‚¹ã¨ã®è«ã„ã§é«˜å¤©åŸã‚’è¿½æ”¾ã•ã‚ŒãŸãŒã€å‡ºé›²ã§è‹±é›„ã¨ãªã£ãŸã€‚', skill:'åæ‹³å‰£ã®ä¸€é–ƒ â€” æ¸¾èº«ã®ä¸€æ’ƒã§å¤§ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼' },
  { id:'jomon_5', eraId:'jomon', rarity:'N',  emoji:'ğŸŒŠ', name:'ã‚¦ãƒ©ã‚·ãƒã‚¿ãƒ­ã‚¦', desc:'æµ·ã®ç¥ã®å®®æ®¿ã‚’è¨ªã‚ŒãŸæ¼å¸«ã€‚ç‰æ‰‹ç®±ã‚’é–‹ã‘ã‚‹ã¨ç™½é«ªã®ç¿ã«ãªã£ãŸã¨ã„ã†ä¼èª¬ã¯ã€æ™‚é–“ã®ä¸æ€è­°ã‚’èªã‚‹ã€‚', skill:'ç‰æ‰‹ç®±ã®ç…™ â€” æ•µã®æ™‚é–“ã‚’å·»ãæˆ»ã™ï¼' },

  // å¤å¢³ãƒ»é£›é³¥
  { id:'asuka_1', eraId:'asuka', rarity:'SR', emoji:'ğŸ“œ', name:'è–å¾³å¤ªå­',   desc:'ä¸€åº¦ã«10äººã®è©±ã‚’èã‘ãŸã¨ã„ã†ä¼èª¬ã‚’æŒã¤æ”¿æ²»ã®å¤©æ‰ã€‚åä¸ƒæ¡ã®æ†²æ³•ãƒ»å† ä½åäºŒéšã‚’åˆ¶å®šã—ã€ä»æ•™ã‚’èˆˆéš†ã•ã›ãŸã€‚', skill:'åä¸ƒæ¡ã®å¾‹ â€” ä»²é–“å…¨å“¡ã®åŠ›ã‚’å¼•ãå‡ºã™ï¼' },
  { id:'asuka_2', eraId:'asuka', rarity:'R',  emoji:'âš”ï¸', name:'è˜‡æˆ‘å…¥é¹¿',   desc:'å¤§åŒ–ã®æ”¹æ–°ã§ä¸­è‡£éŒè¶³ãƒ»ä¸­å¤§å…„çš‡å­ã«å€’ã•ã‚ŒãŸæ¨©åŠ›è€…ã€‚çˆ¶ãƒ»è¦å¤·ã¨ã¨ã‚‚ã«è˜‡æˆ‘æ°å…¨ç››æœŸã‚’ç¯‰ã„ãŸã€‚', skill:'è˜‡æˆ‘ã®è¦‡é“ â€” æ•µã®é˜²å¾¡ã‚’å®Œå…¨ã«ç„¡è¦–ï¼' },
  { id:'asuka_3', eraId:'asuka', rarity:'R',  emoji:'ğŸŒ¸', name:'ä¸­å¤§å…„çš‡å­', desc:'è˜‡æˆ‘æ°ã‚’å€’ã—å¤§åŒ–ã®æ”¹æ–°ã‚’æ–­è¡Œã—ãŸçš‡å­ã€‚å¾Œã«å¤©æ™ºå¤©çš‡ã¨ã—ã¦å³ä½ã—ã€è¿‘æ±Ÿä»¤ã‚’åˆ¶å®šã—ãŸã€‚', skill:'å¤§åŒ–æ”¹æ–°ã®ä»¤ â€” ä»²é–“å…¨å“¡ã®æ”»æ’ƒåŠ›ã‚’å¤§å¹…ã‚¢ãƒƒãƒ—ï¼' },
  { id:'asuka_4', eraId:'asuka', rarity:'N',  emoji:'ğŸ”±', name:'ä¸­è‡£éŒè¶³',   desc:'ä¸­å¤§å…„çš‡å­ã¨çµ„ã‚“ã§å¤§åŒ–ã®æ”¹æ–°ã‚’å®Ÿç¾ã€‚æ­»ã®ç›´å‰ã«ã€Œè—¤åŸã€ã®å§“ã‚’è³œã‚Šã€è—¤åŸæ°ã®å§‹ç¥–ã¨ãªã£ãŸã€‚', skill:'å¯†è¬€ã®ç­– â€” ç›¸æ‰‹ã®æ¬¡ã®è¡Œå‹•ã‚’å°ã˜ã‚‹ï¼' },
  { id:'asuka_5', eraId:'asuka', rarity:'N',  emoji:'ğŸ¯', name:'å¤©æ­¦å¤©çš‡',   desc:'å£¬ç”³ã®ä¹±ã§ç”¥ãƒ»å¤§å‹çš‡å­ã‚’ç ´ã‚Šå³ä½ã€‚æ—¥æœ¬æ›¸ç´€ãƒ»å¤äº‹è¨˜ã®ç·¨çº‚ã‚’å‘½ã˜ã€å¤©çš‡å·ã‚’åˆã‚ã¦ç”¨ã„ãŸã€‚', skill:'é£›é³¥æµ„å¾¡åŸå¾‹ä»¤ â€” å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åº•ä¸Šã’ï¼' },

  // å¥ˆè‰¯ãƒ»å¹³å®‰
  { id:'nara_1', eraId:'nara', rarity:'SR', emoji:'ğŸŒ•', name:'è—¤åŸé“é•·',   desc:'ã€Œã“ã®ä¸–ã‚’ã°æˆ‘ãŒä¸–ã¨ãæ€ãµã€ã¨è© ã‚“ã å¹³å®‰è²´æ—ã®é ‚ç‚¹ã€‚3äººã®å¨˜ã‚’å¤©çš‡ã®åã«ã—ãŸæ¨©åŠ›è€…ã€‚æ‘‚é–¢æ”¿æ²»ã®å…¨ç››æœŸã‚’ç¯‰ã„ãŸã€‚', skill:'æœ›æœˆã®ç›ƒ â€” æº€æœˆã®åŠ›ã§å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æœ€å¤§åŒ–ï¼' },
  { id:'nara_2', eraId:'nara', rarity:'R',  emoji:'ğŸ“–', name:'ç´«å¼éƒ¨',     desc:'ä¸–ç•Œåˆã®é•·ç·¨å°èª¬ã€Œæºæ°ç‰©èªã€ã‚’æ›¸ã„ãŸå¹³å®‰ã®æ‰å¥³ã€‚ä¸€æ¡å¤©çš‡ã®ä¸­å®®ãƒ»å½°å­ã«ä»•ãˆã€ç‹æœæ–‡åŒ–ã®ç²‹ã‚’æã„ãŸã€‚', skill:'æºæ°ç‰©èªã®ç­† â€” æ•µã‚’ç‰©èªã®ä¸­ã«å¹½é–‰ï¼' },
  { id:'nara_3', eraId:'nara', rarity:'R',  emoji:'ğŸ¦Œ', name:'è¡ŒåŸº',       desc:'æ°‘ã®ãŸã‚ã«æ©‹ã‚„æ± ã‚’ä½œã‚Šç¶šã‘ãŸå¥ˆè‰¯ã®åƒ§ã€‚æ±å¤§å¯ºå¤§ä»å»ºç«‹ã«å”åŠ›ã—ã€æ—¥æœ¬åˆã®å¤§åƒ§æ­£ã¨ãªã£ãŸã€‚', skill:'è©è–©ã®æ…ˆæ‚² â€” ä»²é–“å…¨å“¡ã®HPã‚’å…¨å›å¾©ï¼' },
  { id:'nara_4', eraId:'nara', rarity:'N',  emoji:'âœï¸', name:'æ¸…å°‘ç´è¨€',   desc:'ã€Œæ•è‰å­ã€ã§çŸ¥ã‚‰ã‚Œã‚‹å¹³å®‰ã®æ‰å¥³ã€‚ä¸€æ¡å¤©çš‡ã®ä¸­å®®ãƒ»å®šå­ã«ä»•ãˆã€ã€Œã‚’ã‹ã—ã€ã®ç¾æ„è­˜ã§æ™‚ä»£ã‚’æã„ãŸã€‚', skill:'ã‚’ã‹ã—ã®ä¸€ç­† â€” ç›¸æ‰‹ã®æˆ¦æ„ã‚’å–ªå¤±ã•ã›ã‚‹ï¼' },
  { id:'nara_5', eraId:'nara', rarity:'N',  emoji:'ğŸŒ¸', name:'å…‰æ˜çš‡å',   desc:'è–æ­¦å¤©çš‡ã®çš‡åã€‚å­¤å…ãƒ»è²§æ°‘æ•‘æ¸ˆã®æ–½è–¬é™¢ãƒ»æ‚²ç”°é™¢ã‚’è¨­ã‘ã€ä»æ•™ã«ã‚ˆã‚‹ç¤¾ä¼šç¦ç¥‰ã‚’å®Ÿè·µã—ãŸè–å¥³ã€‚', skill:'æ…ˆæ‚²ã®å…‰ â€” ä»²é–“ã®çŠ¶æ…‹ç•°å¸¸ã‚’ã™ã¹ã¦æ²»ç™’ï¼' },

  // éŒå€‰ãƒ»å®¤ç”º
  { id:'kamakura_1', eraId:'kamakura', rarity:'SR', emoji:'ğŸ¯', name:'æºé ¼æœ',   desc:'å¹³æ°ã‚’å€’ã—éŒå€‰ã«åˆã®æ­¦å®¶æ”¿æ¨©ã‚’æ‰“ã¡ç«‹ã¦ãŸã€‚å¼Ÿãƒ»ç¾©çµŒã¨ã®ç¢ºåŸ·ã§ã‚‚çŸ¥ã‚‰ã‚Œã‚‹å†·é™ãªæ”¿æ²»å®¶ã€‚', skill:'éŒå€‰å¹•åºœé–‹åºœ â€” æ­¦å£«å…¨å“¡ã‚’å‘³æ–¹ã«ã¤ã‘ã‚‹ï¼' },
  { id:'kamakura_2', eraId:'kamakura', rarity:'R',  emoji:'âš¡', name:'æºç¾©çµŒ',   desc:'å¤©æ‰çš„ãªæˆ¦è¡“ã§å¹³æ°ã‚’æ»…ã¼ã—ãŸæ‚²åŠ‡ã®æ­¦å°†ã€‚å£‡ãƒæµ¦ã®æˆ¦ã„ã§å‹åˆ©ã™ã‚‹ã‚‚ã€å…„ãƒ»é ¼æœã«è¿½ã‚ã‚Œå¥¥å·ã§æœ€æœŸã‚’è¿ãˆãŸã€‚', skill:'å…«è‰˜é£›ã³ â€” æ•µã®æ”»æ’ƒã‚’å…¨ã¦å›é¿ã—ã¦åæ’ƒï¼' },
  { id:'kamakura_3', eraId:'kamakura', rarity:'R',  emoji:'ğŸŒŠ', name:'åŒ—æ¡æ™‚å®—', desc:'å…ƒå¯‡ï¼ˆæ–‡æ°¸ãƒ»å¼˜å®‰ã®å½¹ï¼‰ã§ãƒ¢ãƒ³ã‚´ãƒ«è»ã®ä¾µæ”»ã‚’é€€ã‘ãŸéŒå€‰å¹•åºœç¬¬8ä»£åŸ·æ¨©ã€‚ã€Œç¥é¢¨ã€ãŒåŠ©ã‘ãŸã€‚', skill:'ç¥é¢¨æ‹›æ¥ â€” æ•µå…¨ä½“ã«åµã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼' },
  { id:'kamakura_4', eraId:'kamakura', rarity:'N',  emoji:'ğŸ­', name:'è¶³åˆ©ç¾©æº€', desc:'å—åŒ—æœã‚’çµ±ä¸€ã—å®¤ç”ºå¹•åºœã®å…¨ç››æœŸã‚’ç¯‰ã„ãŸã€‚é‡‘é–£å¯ºã‚’å»ºã¦ã€æ—¥æ˜è²¿æ˜“ã§è«å¤§ãªå¯Œã‚’å¾—ãŸã€‚', skill:'é‡‘é–£ã®è¼ã â€” å…¨ã¦ã®é˜²å¾¡ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å…‰ï¼' },
  { id:'kamakura_5', eraId:'kamakura', rarity:'N',  emoji:'ğŸŒ', name:'æ¥ æœ¨æ­£æˆ', desc:'å¾Œé†é†å¤©çš‡ã‚’æ”¯ãˆãŸå—æœã®å¿ è‡£ã€‚ã‚²ãƒªãƒ©æˆ¦æ³•ã®å¤©æ‰ã§ã€æ¹Šå·ã®æˆ¦ã„ã§è¶³åˆ©å°Šæ°ã¨æˆ¦ã„å£®çµ¶ãªæœ€æœŸã‚’é‚ã’ãŸã€‚', skill:'åƒæ—©åŸã®å¥‡è¨ˆ â€” æ•µã®æˆ¦åŠ›ã‚’åŠæ¸›ã•ã›ã‚‹ç½ ï¼' },

  //  æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±
  { 'id':'sengoku_1', 'eraId':'sengoku', 'rarity':'SR', 'emoji':'âš”ï¸', 'name':'ç¹”ç”°ä¿¡é•·',   'desc':'ã€Œå¤©ä¸‹å¸ƒæ­¦ã€ã‚’æ²ã’ãŸæˆ¦å›½ã®é©å‘½å…ã€‚é•·ç¯ ã®æˆ¦ã„ã§é‰„ç ²ä¸‰æ®µæ’ƒã¡ã‚’é§†ä½¿ã—ã€æ¥½å¸‚æ¥½åº§ã§çµŒæ¸ˆã‚’è‡ªç”±åŒ–ã—ãŸã€‚', 'skill':'æ˜¯éã«åŠã°ãš â€” ã©ã‚“ãªé€†å¢ƒã‚‚çªç ´ã™ã‚‹å¿…æ®ºæ–¬ï¼' },
  { 'id':'sengoku_2', 'eraId':'sengoku', 'rarity':'R',  'emoji':'ğŸ¯', 'name':'è±Šè‡£ç§€å‰',   'desc':'è¶³è»½ã‹ã‚‰å¤©ä¸‹äººã¸ã€‚ä¿¡é•·ã®å¾Œç¶™è€…ã¨ã—ã¦å¤©ä¸‹çµ±ä¸€ã‚’æœãŸã—ã€å¤ªé–¤æ¤œåœ°ãƒ»åˆ€ç‹©ã‚Šã§è¿‘ä¸–å°å»ºåˆ¶ã®åŸºç›¤ã‚’ç¯‰ã„ãŸã€‚', 'skill':'å¤ªé–¤ã®å‡ºä¸–è¡“ â€” ä»²é–“å…¨å“¡ã®æ”»æ’ƒåŠ›ã‚’2å€ã«ï¼' },
  { 'id':'sengoku_3', 'eraId':'sengoku', 'rarity':'R',  'emoji':'ğŸ²', 'name':'ä¸Šæ‰è¬™ä¿¡',   'desc':'ã€Œè»ç¥ã€ã¨å‘¼ã°ã‚ŒãŸè¶Šå¾Œã®åå°†ã€‚æ­¦ç”°ä¿¡ç„ã¨å·ä¸­å³¶ã§5åº¦æ¿€çªã€‚ç¾©ã‚’é‡ã‚“ã˜ã€æ•µã®æ­¦ç”°ã«å¡©ã‚’é€ã£ãŸã¨ã„ã†é€¸è©±ã§ã‚‚æœ‰åã€‚', 'skill':'æ¯˜æ²™é–€å¤©ã®åŠ è­· â€” æ”»å®ˆä¸¡æ–¹ã‚’æ¥µé™ã¾ã§é«˜ã‚ã‚‹ï¼' },
  { 'id':'sengoku_4', 'eraId':'sengoku', 'rarity':'N',  'emoji':'ğŸ†', 'name':'æ­¦ç”°ä¿¡ç„',   'desc':'ã€Œé¢¨æ—ç«å±±ã€ã®æ——å°ã‚’æ²ã’ãŸç”²æ–ã®è™ã€‚é¨é¦¬éšŠã¨å†…æ”¿ã§æˆ¦å›½æœ€å¼·ã¨è¬³ã‚ã‚ŒãŸãŒã€ä¸Šæ´›é€”ä¸­ã«ç—…æ­»ã—ãŸã€‚', 'skill':'é¢¨æ—ç«å±±ã®é™£ â€” çŠ¶æ³ã«å¿œã˜ãŸæœ€å¼·ã®æˆ¦æ³•ï¼' },
  { 'id':'sengoku_5', 'eraId':'sengoku', 'rarity':'N',  'emoji':'ğŸŒº', 'name':'æ˜æ™ºå…‰ç§€',   'desc':'æœ¬èƒ½å¯ºã®å¤‰ã§ä¿¡é•·ã‚’è¨ã£ãŸè¬€åäººã€‚ã€Œæ•µã¯æœ¬èƒ½å¯ºã«ã‚ã‚Šï¼ã€ã®ä¸€è¨€ã¯æ­´å²ã‚’å¤‰ãˆãŸã€‚ãã®å‹•æ©Ÿã¯ä»Šã‚‚è¬ã®ã¾ã¾ã€‚', 'skill':'æœ¬èƒ½å¯ºã®å¤‰ â€” æœ€å¤§ã®å¥‡è¥²ã§æ•µã‚’ä¸€æ’ƒï¼' },

  //  æ±Ÿæˆ¸
  { 'id':'edo_1', 'eraId':'edo', 'rarity':'SR', 'emoji':'ğŸ—»', 'name':'å¾³å·å®¶åº·',   'desc':'é–¢ãƒ¶åŸã®å‹è€…ã€‚ã€Œé³´ã‹ã¬ãªã‚‰é³´ãã¾ã§å¾…ã¨ã†ãƒ›ãƒˆãƒˆã‚®ã‚¹ã€ã®å¿è€ã§265å¹´ã®æ³°å¹³ã‚’ç¯‰ã„ãŸã€‚å¾å¤·å¤§å°†è»ã¨ã—ã¦æ±Ÿæˆ¸å¹•åºœã‚’é–‹ã„ãŸã€‚', 'skill':'å¤©ä¸‹æ³°å¹³ã®é™£ â€” å…¨ã¦ã®æ”»æ’ƒã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ï¼' },
  { 'id':'edo_2', 'eraId':'edo', 'rarity':'R',  'emoji':'ğŸ“', 'name':'å¾³å·å‰å®—',   'desc':'äº«ä¿ã®æ”¹é©ã‚’æ–­è¡Œã—ãŸ8ä»£å°†è»ã€‚ç›®å®‰ç®±ã‚’è¨­ã‘åº¶æ°‘ã®æ„è¦‹ã‚’æ”¿æ²»ã«æ´»ã‹ã—ãŸã€‚æš´ã‚Œã‚“åŠå°†è»ã®ãƒ¢ãƒ‡ãƒ«ã€‚', 'skill':'äº«ä¿ã®æ”¹é© â€” ä»²é–“å…¨ä½“ã®HPã¨æ”»æ’ƒåŠ›ã‚’å›å¾©ï¼' },
  { 'id':'edo_3', 'eraId':'edo', 'rarity':'R',  'emoji':'ğŸ–Œï¸', 'name':'è‘›é£¾åŒ—æ–',   'desc':'ã€Œå†¨å¶½ä¸‰åå…­æ™¯ã€ã§ä¸–ç•Œã‚’é­…äº†ã—ãŸæ±Ÿæˆ¸ã®çµµå¸«ã€‚90æ­³ã¾ã§æãç¶šã‘ã€ã‚´ãƒƒãƒ›ã‚‰å°è±¡æ´¾ã«ã‚‚å½±éŸ¿ã‚’ä¸ãˆãŸã€‚', 'skill':'å¯Œå¶½ã®æ³¢ â€” èŠ¸è¡“ã®åŠ›ã§æ•µã‚’åœ§å€’ï¼' },
  { 'id':'edo_4', 'eraId':'edo', 'rarity':'N',  'emoji':'ğŸŒ¸', 'name':'æ¾å°¾èŠ­è•‰',   'desc':'ã€Œå¤æ± ã‚„è›™é£›ã³ã“ã‚€æ°´ã®éŸ³ã€ã§çŸ¥ã‚‰ã‚Œã‚‹ä¿³è–ã€‚å¥¥ã®ç´°é“ã§æ±åŒ—ãƒ»åŒ—é™¸ã‚’æ—…ã—ã€ä¿³è«§ã‚’èŠ¸è¡“ã®åŸŸã«é«˜ã‚ãŸã€‚', 'skill':'ä¿³è«§ã®ä¸€å¥ â€” é™å¯‚ã§æ•µã®å‹•ãã‚’å°ã˜ã‚‹ï¼' },
  { 'id':'edo_5', 'eraId':'edo', 'rarity':'N',  'emoji':'ğŸ—ºï¸', 'name':'ä¼Šèƒ½å¿ æ•¬',   'desc':'55æ­³ã‹ã‚‰æ¸¬é‡ã‚’å§‹ã‚ã€åˆã‚ã¦æ­£ç¢ºãªæ—¥æœ¬åœ°å›³ã‚’ä½œæˆã—ãŸã€‚å…¨å›½ã‚’æ­©ã„ãŸè·é›¢ã¯ç´„4ä¸‡kmã€åœ°çƒä¸€å‘¨åˆ†ï¼', 'skill':'å¤§æ—¥æœ¬æ²¿æµ·è¼¿åœ°å…¨å›³ â€” æ•µã®å…¨æƒ…å ±ã‚’è§£æï¼' },

  //  æ˜æ²»ãƒ»å¤§æ­£
  { 'id':'meiji_1', 'eraId':'meiji', 'rarity':'SR', 'emoji':'ğŸŒŠ', 'name':'å‚æœ¬é¾é¦¬',   'desc':'è–©é•·åŒç›Ÿã‚’ä»²ä»‹ã—ãŸå¹•æœ«ã®é¢¨é›²å…ã€‚èˆ¹ä¸­å…«ç­–ã§è¿‘ä»£å›½å®¶ã®ãƒ“ã‚¸ãƒ§ãƒ³ã‚’æãã€å¤§æ”¿å¥‰é‚„ã¸ã®é“ã‚’åˆ‡ã‚Šæ‹“ã„ãŸã€‚', 'skill':'èˆ¹ä¸­å…«ç­– â€” ä»²é–“å…¨å“¡ã®å£«æ°—ã‚’å¤§å¹…ã‚¢ãƒƒãƒ—ï¼' },
  { 'id':'meiji_2', 'eraId':'meiji', 'rarity':'R',  'emoji':'ğŸ›ï¸', 'name':'ä¼Šè—¤åšæ–‡',   'desc':'æ—¥æœ¬åˆã®å†…é–£ç·ç†å¤§è‡£ã€‚å¤§æ—¥æœ¬å¸å›½æ†²æ³•ã‚’èµ·è‰ã—ã€è¿‘ä»£å›½å®¶ã®ç¤ã‚’ç¯‰ã„ãŸã€‚åˆä»£éŸ“å›½çµ±ç›£ã§ã‚‚ã‚ã‚‹ã€‚', 'skill':'æ†²æ³•ã®ç›¾ â€” ä»²é–“å…¨å“¡ã«é‰„å£ã®é˜²å¾¡ï¼' },
  { 'id':'meiji_3', 'eraId':'meiji', 'rarity':'R',  'emoji':'ğŸ’¡', 'name':'ç¦æ²¢è«­å‰',   'desc':'ã€Œå­¦å•ã®ã™ã™ã‚ã€ã§ã€Œå¤©ã¯äººã®ä¸Šã«äººã‚’é€ ã‚‰ãšã€ã¨èª¬ã„ãŸå•“è’™æ€æƒ³å®¶ã€‚æ…¶æ‡‰ç¾©å¡¾ã‚’å‰µè¨­ã—ãŸã€‚', 'skill':'å­¦å•ã®å…‰ â€” æ¬¡ã®å•é¡Œã®ãƒ’ãƒ³ãƒˆã‚’å…ˆèª­ã¿ï¼' },
  { 'id':'meiji_4', 'eraId':'meiji', 'rarity':'N',  'emoji':'âš”ï¸', 'name':'è¥¿éƒ·éš†ç››',   'desc':'è–©æ‘©è—©ã®è‹±é›„ã§æ˜æ²»ç¶­æ–°ã®ç«‹å½¹è€…ã€‚è¥¿å—æˆ¦äº‰ã§æ”¿åºœè»ã«æ•—ã‚Œè‡ªåˆƒã€‚ã€Œæ•¬å¤©æ„›äººã€ã‚’åº§å³ã®éŠ˜ã¨ã—ãŸã€‚', 'skill':'è¥¿éƒ·ã©ã‚“ã®çªæ’ƒ â€” ä»²é–“å…¨å“¡ã‚’å¥®ã„ç«‹ãŸã›ã‚‹ï¼' },
  { 'id':'meiji_5', 'eraId':'meiji', 'rarity':'N',  'emoji':'ğŸ“', 'name':'æ–°æ¸¡æˆ¸ç¨²é€ ',  'desc':'ã€Œæ­¦å£«é“ã€ã‚’è‹±èªã§æ›¸ãã€æ—¥æœ¬ã®ç²¾ç¥æ–‡åŒ–ã‚’ä¸–ç•Œã«ç´¹ä»‹ã—ãŸã€‚æ—§äº”åƒå††æœ­ã®è‚–åƒã§ã‚‚çŸ¥ã‚‰ã‚Œã‚‹æ•™è‚²è€…ã€‚', 'skill':'æ­¦å£«é“ã®å¿ƒ â€” çµ¶ä½“çµ¶å‘½ã‹ã‚‰å¾©æ´»ã™ã‚‹ï¼' },

  //  æ˜­å’Œãƒ»è¿‘ç¾ä»£
  { 'id':'showa_1', 'eraId':'showa', 'rarity':'SR', 'emoji':'ğŸ•Šï¸', 'name':'æ±éƒ·å¹³å…«éƒ', 'desc':'æ—¥æœ¬æµ·æµ·æˆ¦ã§ãƒ­ã‚·ã‚¢ã®ãƒãƒ«ãƒãƒƒã‚¯è‰¦éšŠã‚’æ’ƒç ´ã—ãŸæµ·è»ã®è‹±é›„ã€‚Tå­—æˆ¦æ³•ã§ä¸–ç•Œã®æµ·è»å²ã«æ°¸é ã«åã‚’åˆ»ã‚“ã ã€‚', 'skill':'Tå­—æˆ¦æ³• â€” æ•µå…¨ä½“ã«å¿…ä¸­ã®ä¸€æ–‰å°„æ’ƒï¼' },
  { 'id':'showa_2', 'eraId':'showa', 'rarity':'R',  'emoji':'ğŸƒ', 'name':'é‡‘æ —å››ä¸‰',   'desc':'æ—¥æœ¬åˆã®ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯é¸æ‰‹ã€‚ç¬¬5å›ã‚¹ãƒˆãƒƒã‚¯ãƒ›ãƒ«ãƒ å¤§ä¼šã§æ£„æ¨©æ‰±ã„ã¨ãªã£ãŸãŒã€54å¹´å¾Œã«ã‚´ãƒ¼ãƒ«ã—ãŸä¼èª¬ã®èµ°è€…ã€‚', 'skill':'ä¸å±ˆã®ãƒãƒ©ã‚½ãƒ³ â€” ã©ã‚“ãªçŠ¶æ³ã§ã‚‚è«¦ã‚ãªã„ï¼' },
  { 'id':'showa_3', 'eraId':'showa', 'rarity':'R',  'emoji':'ğŸ”¬', 'name':'é‡å£è‹±ä¸–',   'desc':'æ¢…æ¯’ãƒ»é»„ç†±ç—…ã®ç ”ç©¶ã§ä¸–ç•Œçš„åå£°ã‚’å¾—ãŸç´°èŒå­¦è€…ã€‚è²§ã—ã„å®¶åº­ã‹ã‚‰ä¸–ç•Œã®æœ€å‰ç·šã¸ã€‚æ—§åƒå††æœ­ã®è‚–åƒã€‚', 'skill':'é¡•å¾®é¡ã®ç™ºè¦‹ â€” æ•µã®å¼±ç‚¹ã‚’å®Œå…¨ã«æš´ãï¼' },
  { 'id':'showa_4', 'eraId':'showa', 'rarity':'N',  'emoji':'âœˆï¸', 'name':'å±±æœ¬äº”åå…­', 'desc':'çœŸç æ¹¾æ”»æ’ƒã‚’ç«‹æ¡ˆã—ãŸé€£åˆè‰¦éšŠå¸ä»¤é•·å®˜ã€‚ã€Œã‚„ã£ã¦ã¿ã›ã€è¨€ã£ã¦èã‹ã›ã¦ã€ã•ã›ã¦ã¿ã›â€¦ã€ã®åè¨€ã§çŸ¥ã‚‰ã‚Œã‚‹ã€‚', 'skill':'çœŸç æ¹¾ã®å¥‡è¥² â€” å…ˆæ‰‹å¿…å‹ã®ä¸€æ’ƒï¼' },
  { 'id':'showa_5', 'eraId':'showa', 'rarity':'N',  'emoji':'ğŸŒº', 'name':'ãƒ’ãƒ­ã‚·ãƒã®ä¹™å¥³', 'desc':'åºƒå³¶ãƒ»é•·å´ã¸ã®åŸçˆ†æŠ•ä¸‹ã‚’ç”Ÿãå»¶ã³ãŸäººã€…ã®ç·ç§°ã€‚å¹³å’Œã®å¤§åˆ‡ã•ã‚’èªã‚Šç¶™ãèªã‚Šéƒ¨ã¨ã—ã¦ã€å¾Œä¸–ã«ä¼ãˆç¶šã‘ã¦ã„ã‚‹ã€‚', 'skill':'å¹³å’Œã®ç¥ˆã‚Š â€” æˆ¦é—˜ã‚’çµ‚ã‚ã‚‰ã›ã‚‹æœ€å¾Œã®åŠ›ï¼' },

  // â”€â”€ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆå…¨æ™‚ä»£ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã§è§£æ”¾ï¼‰ â”€â”€
  { id:'secret_1', eraId:'secret', rarity:'SECRET', emoji:'ğŸ‘‘', name:'å¤©ç…§å¤§ç¥',    desc:'æ—¥æœ¬ç¥è©±ã®æœ€é«˜ç¥ã€‚å²©æˆ¸ã«éš ã‚Œã¦ä¸–ç•Œã‚’æš—é—‡ã«åŒ…ã‚“ã ãŒã€ç¥ã€…ã®å®´ã®ç¬‘ã„å£°ã«èª˜ã‚ã‚Œã¦å²©æˆ¸ã‚’é–‹ã„ãŸã€‚çš‡å®¤ã®ç¥–ç¥ã¨ã—ã¦ä¼Šå‹¢ç¥å®®ã«ç¥€ã‚‰ã‚Œã‚‹ã€‚', skill:'å¤©ç…§ã®å…‰ â€” å…¨ã¦ã®é—‡ã‚’æ¶ˆã—å»ã‚‹ç©¶æ¥µã®è¼ãï¼' },
  { id:'secret_2', eraId:'secret', rarity:'SECRET', emoji:'ğŸ‰', name:'é¾é¦¬ã®äº¡éœŠ',   desc:'æš—æ®ºã•ã‚ŒãŸå‚æœ¬é¾é¦¬ãŒæ­´å²ã®å½±ã¨ã—ã¦è˜‡ã£ãŸã€‚ã€Œä¸–ã®äººã¯æˆ‘ã‚’ä½•ã¨ã‚‚è¨€ã‚ã°è¨€ãˆã€æˆ‘ãŒæˆã™äº‹ã¯æˆ‘ã®ã¿ãçŸ¥ã‚‹ã€ã®é­‚ã¯æ°¸é ã«æ—¥æœ¬ã‚’å®ˆã‚Šç¶šã‘ã‚‹ã€‚', skill:'ç¶­æ–°ã®æ€¨å¿µ â€” æ™‚ä»£ã‚’è¶…ãˆãŸä¸€æ’ƒã§æ­´å²ã‚’æ›¸ãæ›ãˆã‚‹ï¼' },
  { id:'secret_3', eraId:'secret', rarity:'SECRET', emoji:'â›©', name:'ãƒ¤ãƒãƒˆã‚¿ã‚±ãƒ«', desc:'æ±è¥¿ã®è›®æ—ã‚’å¾ã—ãŸä¼èª¬ã®è‹±é›„çš‡å­ã€‚è‰è–™å‰£ã§ç‚ã®ç½ ã‚’åˆ‡ã‚ŠæŠœã‘ã€ç™½é³¥ã¨ãªã£ã¦æ˜‡å¤©ã—ãŸã¨ã„ã†ç¥è©±ã¯æ—¥æœ¬æ­¦å‹‡ä¼ã®åŸç‚¹ã€‚', skill:'è‰è–™å‰£ã®ä¸€é–ƒ â€” ä¼èª¬ã®å‰£ãŒå…¨ã¦ã‚’æ–­ã¡åˆ‡ã‚‹ï¼' },
];
// Python dict â†’ JS object ã«å¤‰æ›æ¸ˆã¿ï¼ˆä¸Šè¨˜ã¯å®Ÿéš›ã«ã¯æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã†ï¼‰

// owned: ã‚«ãƒ¼ãƒ‰IDã®é…åˆ—ï¼ˆé‡è¤‡ã‚ã‚Šï¼‰
function loadOwned() {
  try { return JSON.parse(localStorage.getItem(ZUKAN_STORAGE_KEY) || '[]'); }
  catch { return []; }
}
function saveOwned(arr) {
  localStorage.setItem(ZUKAN_STORAGE_KEY, JSON.stringify(arr));
}
// å¾Œæ–¹äº’æ›: unlocked = é‡è¤‡ãªã—ã®Set
function loadUnlocked() {
  return new Set(loadOwned());
}
function loadNewFlags() {
  try { return new Set(JSON.parse(localStorage.getItem(ZUKAN_NEW_KEY) || '[]')); }
  catch { return new Set(); }
}
function saveNewFlags(set) {
  localStorage.setItem(ZUKAN_NEW_KEY, JSON.stringify([...set]));
}

// å…¨8æ™‚ä»£ã‚’ã‚¯ãƒªã‚¢ã—ãŸã‹ãƒã‚§ãƒƒã‚¯ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè§£æ”¾åˆ¤å®šç”¨ï¼‰
const SECRET_CLEARED_KEY = 'nihonshi_cleared_eras';
function loadClearedEras() {
  try { return new Set(JSON.parse(localStorage.getItem(SECRET_CLEARED_KEY) || '[]')); }
  catch { return new Set(); }
}
function saveClearedEras(set) {
  localStorage.setItem(SECRET_CLEARED_KEY, JSON.stringify([...set]));
}
function markEraCleared(eraId) {
  const cleared = loadClearedEras();
  cleared.add(eraId);
  saveClearedEras(cleared);
  return cleared.size >= 8; // å…¨8æ™‚ä»£ã‚¯ãƒªã‚¢ã—ãŸã‚‰true
}

// å…¨å•æ­£è§£æ™‚ï¼šãã®æ™‚ä»£ã®å…¨ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ãƒ¬ã‚¢åº¦ã«å¾“ã£ã¦ãƒ©ãƒ³ãƒ€ãƒ 1æšå–å¾—
// + å…¨8æ™‚ä»£ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæŠ½é¸ãƒãƒ£ãƒ³ã‚¹
function drawCharacter(eraId) {
  // å…¨8æ™‚ä»£ã‚¯ãƒªã‚¢è¨˜éŒ²
  const allCleared = markEraCleared(eraId);

  // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæŠ½é¸ï¼ˆå…¨8æ™‚ä»£ã‚¯ãƒªã‚¢æ¸ˆã¿ã®å ´åˆã€5%ã®ç¢ºç‡ã§å‡ºç¾ï¼‰
  if (allCleared && Math.random() < 0.05) {
    const secretPool = ALL_CHARS.filter(c => c.eraId === 'secret');
    const owned = loadOwned();
    const unownedSecrets = secretPool.filter(c => !owned.some(id => id === c.id));
    // æœªç²å¾—ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒã‚ã‚Œã°å„ªå…ˆã—ã¦å‡ºã™
    const secretTarget = unownedSecrets.length > 0
      ? unownedSecrets[Math.floor(Math.random() * unownedSecrets.length)]
      : secretPool[Math.floor(Math.random() * secretPool.length)];
    const isFirstGet = !owned.some(id => id === secretTarget.id);
    owned.push(secretTarget.id);
    saveOwned(owned);
    if (isFirstGet) {
      const newFlags = loadNewFlags();
      newFlags.add(secretTarget.id);
      saveNewFlags(newFlags);
    }
    secretTarget.isDupe = !isFirstGet;
    secretTarget.isSecret = true;
    return secretTarget;
  }

  // é€šå¸¸æŠ½é¸
  const pool = ALL_CHARS.filter(c => c.eraId === eraId);
  if (pool.length === 0) return null;

  // ãƒ¬ã‚¢åº¦é‡ã¿ã¥ã‘
  const weights = { SR: 15, R: 35, N: 50 };
  const weighted = [];
  pool.forEach(c => {
    for (let i = 0; i < weights[c.rarity]; i++) weighted.push(c);
  });
  const drawn = weighted[Math.floor(Math.random() * weighted.length)];

  // æ‰€æŒãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆé‡è¤‡OKï¼‰
  const owned = loadOwned();
  const isFirstGet = !owned.some(id => id === drawn.id);
  owned.push(drawn.id);
  saveOwned(owned);

  // NEWãƒ•ãƒ©ã‚°ã¯åˆå›ã®ã¿
  if (isFirstGet) {
    const newFlags = loadNewFlags();
    newFlags.add(drawn.id);
    saveNewFlags(newFlags);
  }
  drawn.isDupe = !isFirstGet; // é‡è¤‡ãƒ•ãƒ©ã‚°
  return drawn;
}

function showZukan() {
  showScreen('screen-zukan');
  renderZukan();
}

function renderZukan() {
  const unlocked = loadUnlocked();
  const newFlags = loadNewFlags();
  const total = ALL_CHARS.length;
  const count = unlocked.size;

  const pct = total > 0 ? (count / total * 100) : 0;
  document.getElementById('zukanProgressFill').style.width = pct + '%';
  document.getElementById('zukanProgressLabel').textContent = `${count} / ${total} è§£æ”¾æ¸ˆã¿`;

  const container = document.getElementById('zukanContent');
  container.innerHTML = '';

  ERAS.forEach(era => {
    const eraChars = ALL_CHARS.filter(c => c.eraId === era.id);
    const section = document.createElement('div');
    section.className = 'zukan-era-section';

    const eraTitle = document.createElement('div');
    eraTitle.className = 'zukan-era-title';
    eraTitle.style.color = era.color;
    const eraCount = eraChars.filter(c => unlocked.has(c.id)).length;
    eraTitle.textContent = `${era.emoji}  ${era.name}  ${eraCount}/${eraChars.length}`;
    section.appendChild(eraTitle);

    const grid = document.createElement('div');
    grid.className = 'zukan-grid';

    eraChars.forEach(ch => {
      const isUnlocked = unlocked.has(ch.id);
      const isNew = newFlags.has(ch.id);
      const rarityColor = { SR:'#FFD700', R:'#C084FC', N:'#94A3B8' };
      const rarityBg    = { SR:'rgba(255,215,0,0.15)', R:'rgba(192,132,252,0.12)', N:'rgba(148,163,184,0.08)' };

      const card = document.createElement('div');
      card.className = `zukan-card ${isUnlocked ? 'unlocked' : 'locked'} ${isNew ? 'is-new' : ''}`;
      if (isUnlocked) card.style.borderColor = rarityColor[ch.rarity] + '66';

      const ownCount = loadOwned().filter(id => id === ch.id).length;
      card.innerHTML = `
        <span class="zukan-new-badge">NEW</span>
        <span class="zukan-lock-icon">ğŸ”’</span>
        <div class="zukan-rarity-badge" style="color:${rarityColor[ch.rarity]};background:${rarityBg[ch.rarity]}">${ch.rarity}</div>
        ${ownCount > 1 ? `<span class="zukan-dupe-badge">Ã—${ownCount}</span>` : ''}
        <div class="zukan-card-inner">
          <div class="zukan-char-emoji-wrap" style="${isUnlocked ? `background:radial-gradient(circle,${era.glow},transparent)` : ''}">
            ${isUnlocked ? ch.emoji : 'ï¼Ÿ'}
          </div>
          <div class="zukan-card-name">${isUnlocked ? ch.name : 'ï¼Ÿï¼Ÿï¼Ÿ'}</div>
          <div class="zukan-card-era">${ch.rarity}</div>
        </div>
      `;
      if (isUnlocked) {
        card.onclick = () => openZukanModal(ch, era, newFlags);
      }
      grid.appendChild(card);
    });

    section.appendChild(grid);
    container.appendChild(section);
  });

  // â”€â”€ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€
  const secretChars = ALL_CHARS.filter(c => c.eraId === 'secret');
  const secretSection = document.createElement('div');
  secretSection.className = 'zukan-era-section';
  const secretTitle = document.createElement('div');
  secretTitle.className = 'zukan-era-title';
  secretTitle.style.color = '#FFD700';
  const secretCount = secretChars.filter(c => unlocked.has(c.id)).length;
  secretTitle.textContent = `âœ¨  ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ  ${secretCount}/${secretChars.length}`;
  secretSection.appendChild(secretTitle);
  const allClearedNow = loadClearedEras().size >= 8;
  if (!allClearedNow) {
    const hint = document.createElement('div');
    hint.style.cssText = 'padding:12px 0 4px; font-size:11px; color:rgba(245,240,232,0.3); letter-spacing:0.1em;';
    hint.textContent = 'å…¨8æ™‚ä»£ã‚’å…¨å•æ­£è§£ã‚¯ãƒªã‚¢ã™ã‚‹ã¨è§£æ”¾ãƒãƒ£ãƒ³ã‚¹ãŒç™ºç”Ÿâ€¦ï¼Ÿ';
    secretSection.appendChild(hint);
  } else {
    const secretGrid = document.createElement('div');
    secretGrid.className = 'zukan-grid';
    secretChars.forEach(ch => {
      const isUnlocked = unlocked.has(ch.id);
      const isNew = newFlags.has(ch.id);
      const card = document.createElement('div');
      card.className = `zukan-card ${isUnlocked ? 'unlocked' : 'locked'} ${isNew ? 'is-new' : ''}`;
      if (isUnlocked) card.style.cssText = 'border-color:rgba(255,215,0,0.6);box-shadow:0 0 20px rgba(255,215,0,0.25)';
      const ownCount = loadOwned().filter(id => id === ch.id).length;
      card.innerHTML = `
        <span class="zukan-new-badge">NEW</span>
        <span class="zukan-lock-icon">ğŸ”’</span>
        <div class="zukan-rarity-badge" style="color:#FFD700;background:rgba(255,215,0,0.15)">SECRET</div>
        ${ownCount > 1 ? \`<span class="zukan-dupe-badge">Ã—\${ownCount}</span>\` : ''}
        <div class="zukan-card-inner">
          <div class="zukan-char-emoji-wrap" style="${isUnlocked ? 'background:radial-gradient(circle,rgba(255,215,0,0.3),transparent)' : ''}">
            \${isUnlocked ? ch.emoji : 'âœ¨'}
          </div>
          <div class="zukan-card-name">\${isUnlocked ? ch.name : '???'}</div>
          <div class="zukan-card-era">SECRET</div>
        </div>
      `;
      if (isUnlocked) {
        card.onclick = () => {
          newFlags.delete(ch.id);
          saveNewFlags(newFlags);
          document.getElementById('modalEmoji').textContent = ch.emoji;
          document.getElementById('modalName').textContent = ch.name;
          document.getElementById('modalEra').textContent = 'âœ¨ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ';
          document.getElementById('modalDesc').textContent = ch.desc;
          document.getElementById('modalSkill').textContent = ch.skill;
          document.getElementById('zukanModalOverlay').classList.add('open');
        };
      }
      secretGrid.appendChild(card);
    });
    secretSection.appendChild(secretGrid);
  }
  container.appendChild(secretSection);

  const pad = document.createElement('div');
  pad.style.height = '40px';
  container.appendChild(pad);
}

function openZukanModal(ch, era, newFlags) {
  newFlags.delete(ch.id);
  saveNewFlags(newFlags);

  const rarityLabel = { SR:'â­â­â­ è¶…ãƒ¬ã‚¢', R:'â­â­ ãƒ¬ã‚¢', N:'â­ ãƒãƒ¼ãƒãƒ«' };
  document.getElementById('modalEmoji').textContent = ch.emoji;
  document.getElementById('modalName').textContent = ch.name;
  document.getElementById('modalEra').textContent = `${era.name}  ï¼  ${rarityLabel[ch.rarity]}`;
  document.getElementById('modalDesc').textContent = ch.desc;
  document.getElementById('modalSkill').textContent = ch.skill;
  document.getElementById('zukanModalOverlay').classList.add('open');
}

function closeZukanModal(e) {
  if (e && e.target !== document.getElementById('zukanModalOverlay')) return;
  document.getElementById('zukanModalOverlay').classList.remove('open');
  renderZukan();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RESULT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult() {
  showScreen('screen-result');
  // å…¨å•æ­£è§£ã§ã‚­ãƒ£ãƒ©ç²å¾—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ æŠ½é¸ï¼‰
  const isPerfect = correctCount === currentQuestions.length;
  const drawnChar = isPerfect ? drawCharacter(currentEra.id) : null;
  const isNewUnlock = drawnChar !== null;
  const pct = correctCount / currentQuestions.length;
  let rank, title;
  if (pct === 1)      { rank = 'ğŸ†'; title = 'å¤©ã€€ä¸‹ã€€äºº'; }
  else if (pct >= 0.8){ rank = 'â­â­'; title = 'æ­´å²ã®ä½¿ã„æ‰‹'; }
  else if (pct >= 0.6){ rank = 'â­'; title = 'æ­´å²ã®è¦‹ç¿’ã„'; }
  else if (pct >= 0.4){ rank = 'ğŸ“š'; title = 'ã¾ã ã¾ã ä¿®è¡Œä¸­'; }
  else                { rank = 'ğŸ’€'; title = 'æ•—è€…å¾©æ´»ã‚’ç‹™ãˆï¼'; }

  document.getElementById('resultRank').textContent = rank;
  document.getElementById('resultTitle').textContent = title;
  document.getElementById('resultScore').textContent = score;
  document.getElementById('resultCorrect').textContent =
    `${currentQuestions.length}å•ä¸­ ${correctCount}å•æ­£è§£`;

  // ã‚­ãƒ£ãƒ©è¡¨ç¤ºã‚¨ãƒªã‚¢ã®åˆ¶å¾¡
  const charArea = document.getElementById('result-char-area');
  if (isPerfect) {
    charArea.style.display = '';
    if (drawnChar) {
      const rarityLabel = { SR:'â­â­â­ è¶…ãƒ¬ã‚¢', R:'â­â­ ãƒ¬ã‚¢', N:'â­ ãƒãƒ¼ãƒãƒ«', SECRET:'ğŸŒŸ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ' };
      const isDupe = drawnChar.isDupe;
      const isSecret = drawnChar.isSecret;
      if (isSecret) {
        document.getElementById('result-char-unlocked-label').textContent =
          isDupe ? 'ğŸŒŸ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ GETï¼ï¼ˆé‡è¤‡ï¼‰' : 'âœ¨ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè§£æ”¾ï¼ï¼';
        // ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¼”å‡º: èƒŒæ™¯ã‚’ä¸€ç¬ã‚´ãƒ¼ãƒ«ãƒ‰ã«
        const el = document.getElementById('result-char-area');
        el.style.transition = 'background 0.3s';
        el.style.background = 'rgba(212,160,23,0.15)';
        setTimeout(() => { el.style.background = ''; }, 1500);
      } else {
        document.getElementById('result-char-unlocked-label').textContent =
          isDupe ? `${rarityLabel[drawnChar.rarity]} GETï¼ï¼ˆé‡è¤‡ï¼‰` : `ğŸ”“ ${rarityLabel[drawnChar.rarity]} GETï¼`;
      }
      document.getElementById('unlockedEmoji').textContent = drawnChar.emoji;
      document.getElementById('unlockedName').textContent = drawnChar.name + (isDupe && !isSecret ? 'ï¼ˆ2æšç›®ä»¥é™ï¼‰' : '');
    }
  } else {
    charArea.style.display = 'none';
  }
}

function replayQuiz() { startQuiz(currentEra); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN / PASSWORD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ADMIN_PASSWORD = 'poopoo0730';
const NOTION_DB_ID = '518d967babdf4bddb687264b1999d75b';
const NOTION_CACHE_KEY = 'nihonshi_notion_questions';
const NOTION_API_KEY_KEY = 'nihonshi_notion_api_key';
const STORAGE_KEY = 'nihonshi_custom_questions';
let selectedAnswerIndex = -1;

function showPassword() {
  showScreen('screen-password');
  const inp = document.getElementById('pwInput');
  inp.value = '';
  document.getElementById('pwError').textContent = '';
  inp.classList.remove('error');
  setTimeout(() => inp.focus(), 300);
}

function togglePwVisibility() {
  const inp = document.getElementById('pwInput');
  const btn = document.getElementById('pwToggle');
  if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'ğŸ™ˆ'; }
  else { inp.type = 'password'; btn.textContent = 'ğŸ‘'; }
}

function checkPassword() {
  const val = document.getElementById('pwInput').value;
  const errEl = document.getElementById('pwError');
  const inp = document.getElementById('pwInput');
  if (val === ADMIN_PASSWORD) {
    errEl.textContent = '';
    showAdmin();
  } else {
    inp.classList.remove('error');
    void inp.offsetWidth;
    inp.classList.add('error');
    errEl.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™';
    inp.value = '';
    setTimeout(() => inp.classList.remove('error'), 500);
  }
}

function showAdmin() {
  showScreen('screen-admin');
  // ä¿å­˜æ¸ˆã¿APIã‚­ãƒ¼ã‚’å¾©å…ƒ
  const savedKey = localStorage.getItem(NOTION_API_KEY_KEY) || '';
  const inp = document.getElementById('notionApiKeyInput');
  if (inp) inp.value = savedKey;
  resetForm();
  renderAdminList();
  updateAdminStats();
}

function setAnswer(idx) {
  selectedAnswerIndex = idx;
  ['choiceA','choiceB','choiceC','choiceD'].forEach((id, i) => {
    document.getElementById(id).classList.toggle('is-answer', i === idx);
  });
}

function resetForm() {
  document.getElementById('formQuestion').value = '';
  document.getElementById('formHint').value = '';
  document.getElementById('formEra').value = 'sengoku';
  document.getElementById('formDifficulty').value = 'normal';
  ['choiceA','choiceB','choiceC','choiceD'].forEach(id => {
    document.getElementById(id).value = '';
    document.getElementById(id).classList.remove('is-answer');
  });
  selectedAnswerIndex = -1;
}

function loadCustomQuestions() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  } catch { return []; }
}

function saveCustomQuestions(arr) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

function addCustomQuestion() {
  const q = document.getElementById('formQuestion').value.trim();
  const a = document.getElementById('choiceA').value.trim();
  const b = document.getElementById('choiceB').value.trim();
  const c = document.getElementById('choiceC').value.trim();
  const d = document.getElementById('choiceD').value.trim();

  if (!q) { showToast('å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', true); return; }
  if (!a || !b || !c || !d) { showToast('é¸æŠè‚¢ã‚’4ã¤ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„', true); return; }
  if (selectedAnswerIndex === -1) { showToast('æ­£è§£ã®é¸æŠè‚¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„', true); return; }

  const eraId = document.getElementById('formEra').value;
  const newQ = {
    id: Date.now(),
    eraId,
    q,
    choices: [a, b, c, d],
    ans: selectedAnswerIndex,
    hint: document.getElementById('formHint').value.trim() || 'é ‘å¼µã‚Œï¼',
    difficulty: document.getElementById('formDifficulty').value
  };

  const arr = loadCustomQuestions();
  arr.push(newQ);
  saveCustomQuestions(arr);

  // ERAã®questionsã«ã‚‚æ³¨å…¥
  injectCustomQuestions();

  resetForm();
  renderAdminList();
  updateAdminStats();
  showToast('âœ… å•é¡Œã‚’è¿½åŠ ã—ã¾ã—ãŸï¼');
}

function deleteCustomQuestion(id) {
  const arr = loadCustomQuestions().filter(q => q.id !== id);
  saveCustomQuestions(arr);
  injectCustomQuestions();
  renderAdminList();
  updateAdminStats();
  showToast('ğŸ—‘ å‰Šé™¤ã—ã¾ã—ãŸ');
}

// Notionã‹ã‚‰å•é¡Œã‚’åŒæœŸ
async function syncFromNotion() {
  const apiKey = document.getElementById('notionApiKeyInput').value.trim();
  if (!apiKey) { showToast('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', true); return; }
  localStorage.setItem(NOTION_API_KEY_KEY, apiKey);

  const statusEl = document.getElementById('notionSyncStatus');
  statusEl.textContent = 'åŒæœŸä¸­...';

  try {
    const res = await fetch(`https://api.anthropic.com/v1/proxy/notion/v1/databases/${NOTION_DB_ID}/query`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Notion-Version': '2022-06-28',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        filter: { property: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', select: { equals: 'å®Œæˆ' } },
        page_size: 100,
      }),
    });

    if (!res.ok) {
      // CORSã®å ´åˆã¯ç›´æ¥Notion APIã‚’è©¦ã¿ã‚‹
      throw new Error(`HTTP ${res.status}`);
    }

    const data = await res.json();
    const questions = parseNotionResults(data.results);
    localStorage.setItem(NOTION_CACHE_KEY, JSON.stringify(questions));
    injectNotionQuestions();
    statusEl.textContent = `âœ… ${questions.length}å•ã‚’åŒæœŸã—ã¾ã—ãŸ`;
    showToast(`ğŸ“š Notionã‹ã‚‰${questions.length}å•ã‚’å–å¾—ã—ã¾ã—ãŸï¼`);
  } catch(e) {
    // ãƒ—ãƒ­ã‚­ã‚·ãªã—ã§ç›´æ¥è©¦ã¿ã‚‹
    try {
      const res2 = await fetch(`https://api.notion.com/v1/databases/${NOTION_DB_ID}/query`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${apiKey}`,
          'Notion-Version': '2022-06-28',
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          filter: { property: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', select: { equals: 'å®Œæˆ' } },
          page_size: 100,
        }),
      });
      if (!res2.ok) throw new Error(`HTTP ${res2.status}`);
      const data2 = await res2.json();
      const questions2 = parseNotionResults(data2.results);
      localStorage.setItem(NOTION_CACHE_KEY, JSON.stringify(questions2));
      injectNotionQuestions();
      statusEl.textContent = `âœ… ${questions2.length}å•ã‚’åŒæœŸã—ã¾ã—ãŸ`;
      showToast(`ğŸ“š Notionã‹ã‚‰${questions2.length}å•ã‚’å–å¾—ã—ã¾ã—ãŸï¼`);
    } catch(e2) {
      statusEl.textContent = 'âŒ åŒæœŸå¤±æ•—ï¼ˆCORSã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼‰';
      showToast('åŒæœŸå¤±æ•—ã€‚APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„', true);
      console.error(e2);
    }
  }
}

// Notionã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ã‚¤ã‚ºå•é¡Œå½¢å¼ã«å¤‰æ›
function parseNotionResults(results) {
  const eraMap = {
    'ç¸„æ–‡ãƒ»å¼¥ç”Ÿ':'jomon', 'å¤å¢³ãƒ»é£›é³¥':'asuka', 'å¥ˆè‰¯ãƒ»å¹³å®‰':'nara',
    'éŒå€‰ãƒ»å®¤ç”º':'kamakura', 'æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±':'sengoku', 'æ±Ÿæˆ¸':'edo',
    'æ˜æ²»ãƒ»å¤§æ­£':'meiji', 'æ˜­å’Œãƒ»è¿‘ç¾ä»£':'showa'
  };
  const ansMap = { A:0, B:1, C:2, D:3 };
  return results.map(page => {
    const p = page.properties;
    const getText = key => p[key]?.rich_text?.[0]?.plain_text || p[key]?.title?.[0]?.plain_text || '';
    const getSelect = key => p[key]?.select?.name || '';
    const era = getSelect('æ™‚ä»£');
    const ans = getSelect('æ­£è§£');
    return {
      id: page.id,
      eraId: eraMap[era] || 'sengoku',
      q: getText('å•é¡Œæ–‡'),
      choices: [getText('é¸æŠè‚¢A'), getText('é¸æŠè‚¢B'), getText('é¸æŠè‚¢C'), getText('é¸æŠè‚¢D')],
      ans: ansMap[ans] ?? 0,
      hint: getText('ãƒ’ãƒ³ãƒˆæ–‡') || 'é ‘å¼µã‚Œï¼',
      difficulty: getSelect('é›£æ˜“åº¦') || 'normal',
      _notion: true,
    };
  }).filter(q => q.q && q.choices[0]);
}

// Notionã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã‚’ERASã«æ³¨å…¥
function injectNotionQuestions() {
  ERAS.forEach(era => { era.questions = era.questions.filter(q => !q._notion); });
  try {
    const cached = JSON.parse(localStorage.getItem(NOTION_CACHE_KEY) || '[]');
    cached.forEach(q => {
      const era = ERAS.find(e => e.id === q.eraId);
      if (era) era.questions.push(q);
    });
  } catch {}
}

function injectCustomQuestions() {
  // ã¾ãšã‚«ã‚¹ã‚¿ãƒ å•é¡Œã‚’ERASã‹ã‚‰ä¸€æ—¦é™¤å»
  ERAS.forEach(era => {
    era.questions = era.questions.filter(q => !q._custom);
  });
  // å†æ³¨å…¥
  loadCustomQuestions().forEach(cq => {
    const era = ERAS.find(e => e.id === cq.eraId);
    if (era) era.questions.push({ ...cq, _custom: true });
  });
}

function updateAdminStats() {
  const custom = loadCustomQuestions().length;
  const builtin = ERAS.reduce((sum, e) => sum + e.questions.filter(q => !q._custom).length, 0);
  document.getElementById('statCustom').textContent = custom;
  document.getElementById('statBuiltin').textContent = builtin;
  document.getElementById('statTotal').textContent = builtin + custom;
}

function renderAdminList() {
  const list = document.getElementById('adminQList');
  const arr = loadCustomQuestions();
  const eraColors = {
    jomon:'#8B6914', asuka:'#5a4f9a', nara:'#3a7a3a',
    kamakura:'#7a2020', sengoku:'#cc2200', edo:'#1a5a8a',
    meiji:'#9a4a00', showa:'#3a6a3a'
  };
  const eraNames = {
    jomon:'ç¸„æ–‡ãƒ»å¼¥ç”Ÿ', asuka:'å¤å¢³ãƒ»é£›é³¥', nara:'å¥ˆè‰¯ãƒ»å¹³å®‰',
    kamakura:'éŒå€‰ãƒ»å®¤ç”º', sengoku:'æˆ¦å›½ãƒ»å®‰åœŸæ¡ƒå±±', edo:'æ±Ÿæˆ¸',
    meiji:'æ˜æ²»ãƒ»å¤§æ­£', showa:'æ˜­å’Œãƒ»è¿‘ç¾ä»£'
  };
  if (arr.length === 0) {
    list.innerHTML = '<div class="admin-empty">ã¾ã å•é¡ŒãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
    return;
  }
  list.innerHTML = arr.map(q => `
    <div class="admin-q-item">
      <span class="admin-q-era-badge" style="color:${eraColors[q.eraId]||'#fff'};border-color:${eraColors[q.eraId]||'#fff'}">${eraNames[q.eraId]||q.eraId}</span>
      <div class="admin-q-text-wrap">
        <div class="admin-q-text">${q.q}</div>
        <div class="admin-q-meta">æ­£è§£ï¼š${['ï¼¡','ï¼¢','ï¼£','ï¼¤'][q.ans]}ã€Œ${q.choices[q.ans]}ã€</div>
      </div>
      <button class="admin-q-delete" onclick="deleteCustomQuestion(${q.id})">ğŸ—‘</button>
    </div>
  `).join('');
}

let toastTimer = null;
function showToast(msg, isError = false) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.toggle('error-toast', isError);
  el.classList.add('show');
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

// èµ·å‹•æ™‚ã«ã‚«ã‚¹ã‚¿ãƒ å•é¡Œãƒ»Notionå•é¡Œï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ã‚’æ³¨å…¥
injectCustomQuestions();
injectNotionQuestions(); // ã¾ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã™ãåæ˜ 

// APIã‚­ãƒ¼ãŒä¿å­˜æ¸ˆã¿ãªã‚‰ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€æ–°ã‚’ãƒ•ã‚§ãƒƒãƒ
(async () => {
  const apiKey = localStorage.getItem(NOTION_API_KEY_KEY);
  if (!apiKey) return;
  try {
    const res = await fetch(`https://api.notion.com/v1/databases/${NOTION_DB_ID}/query`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Notion-Version': '2022-06-28',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        filter: { property: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', select: { equals: 'å®Œæˆ' } },
        page_size: 100,
      }),
    });
    if (!res.ok) return;
    const data = await res.json();
    const questions = parseNotionResults(data.results);
    if (questions.length > 0) {
      localStorage.setItem(NOTION_CACHE_KEY, JSON.stringify(questions));
      injectNotionQuestions(); // æœ€æ–°ã«æ›´æ–°
      console.log(`[Notion] ${questions.length}å•ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸã—ã¾ã—ãŸ`);
    }
  } catch(e) {
    // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç­‰ã§ã¯å¤±æ•—ã—ã¦OKï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã„ç¶šã‘ã‚‹ï¼‰
    console.log('[Notion] ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã¾ãŸã¯CORSï¼‰');
  }
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SERVICE WORKER ç™»éŒ²
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js")
      .then(() => console.log("SWç™»éŒ²å®Œäº†"))
      .catch((e) => console.log("SWç™»éŒ²å¤±æ•—:", e));
  });
}
</script>
</body>
</html>
